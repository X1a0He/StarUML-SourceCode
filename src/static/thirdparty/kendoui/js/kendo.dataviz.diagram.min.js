/*
* Kendo UI v2014.1.528 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.data.min","./kendo.draganddrop.min","./kendo.userevents.min","./kendo.mobile.scroller.min","./kendo.core.min","./kendo.dataviz.core.min"],e)}(function(){return function(e){function t(e){var t=e.originalEvent,n=0;return t.wheelDelta?(n=-t.wheelDelta/40,n=n>0?i.ceil(n):i.floor(n)):t.detail&&(n=t.detail),n}var n=e.extend,i=Math;n(e.fn,{mousewheel:function(e,i){var o=n({ns:""},i||{}),r=this,a="DOMMouseScroll"+o.ns+" mousewheel"+o.ns;return r.on(a,function(n){n.data={delta:t(n)},e(n)}),r}})}(window.kendo.jQuery),function(e,t){function n(e,n,i){function o(e){for(var t=1;e*t%1;)t*=10;return t}var r,a,s,l;if(t===e||t===n)return[];if(i&&u.sign(n-e)!=u.sign(i))throw"The sign of the increment should allow to reach the stop-value.";if(i=i||1,e=e||0,n=n||e,(n-e)/i===1/0)throw"Infinite range defined.";if(r=[],a=-1,l=o(Math.abs(i)),e*=l,n*=l,i*=l,e>n&&i>0&&(i=-i),0>i)for(;(s=e+i*++a)>=n;)r.push(s/l);else for(;(s=e+i*++a)<=n;)r.push(s/l);return r}function i(e,t){if(e==t)return 0;var n=t.x-e.x,i=e.y-t.y,o=Math.atan(n/i);return i>=0?0>n?o+2*Math.PI:o:o+Math.PI}var o,r,a=window.kendo,s=a.dataviz.diagram={},l=a.deepExtend,d=e.isArray,c=1e-6,u={};l(u,{isNearZero:function(e){return Math.abs(e)<c},isDefined:function(e){return t!==e},isUndefined:function(e){return t===e||null===e},isObject:function(e){return e===Object(e)},has:function(e,t){return Object.hasOwnProperty.call(e,t)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isBoolean:function(e){return"[object Boolean]"==Object.prototype.toString.call(e)},isType:function(e,t){return Object.prototype.toString.call(e)=="[object "+t+"]"},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isEmpty:function(e){if(null===e)return!0;if(d(e)||u.isString(e))return 0===e.length;for(var t in e)if(u.has(e,t))return!1;return!0},simpleExtend:function(e,t){if(u.isObject(t))for(var n in t)e[n]=t[n]},initArray:function(e,t){var n,i=[];for(n=0;e>n;++n)i[n]=t;return i},serializePoints:function(e){var t,n,i=[];for(t=0;e.length>t;t++)n=e[t],i.push(n.x+";"+n.y);return i.join(";")},deserializePoints:function(e){var t,n=e.split(";"),i=[];if(n.length%2!==0)throw"Not an array of points.";for(t=0;n.length>t;t+=2)i.push(new s.Point(parseInt(n[t],10),parseInt(n[t+1],10)));return i},randomInteger:function(e,t){return parseInt(Math.floor(Math.random()*t)+e,10)},DFT:function(e,t){var n,i;if(t(e),e.childNodes)for(n=0;e.childNodes.length>n;n++)i=e.childNodes[n],this.DFT(i,t)},getMatrixAngle:function(e){return null===e||0===e.d?0:180*Math.atan2(e.b,e.d)/Math.PI},getMatrixScaling:function(e){var t=Math.sqrt(e.a*e.a+e.c*e.c),n=Math.sqrt(e.b*e.b+e.d*e.d);return[t,n]}}),u.sign=function(e){return e?0>e?-1:1:0},u.findAngle=function(e,t){return 180*i(e,t)/Math.PI},u.forEach=function(e,t,n){for(var i=0;e.length>i;i++)t.call(n,e[i],i,e)},u.any=function(e,t){for(var n=0;e.length>n;++n)if(t(e[n]))return e[n];return null},u.remove=function(e,t){for(var n;-1!==(n=u.indexOf(e,t));)e.splice(n,1);return e},u.contains=function(e,t){return-1!==u.indexOf(e,t)},u.indexOf=function(t,n){return e.inArray(n,t)},u.fold=function(e,t,n,i){var o,r,a=arguments.length>2;for(o=0;e.length>o;o++)r=e[o],a?n=t.call(i,n,r,o,e):(n=r,a=!0);if(!a)throw"Reduce of empty array with no initial value";return n},u.find=function(e,t,n){var i;return u.any(e,function(e,o,r){return t.call(n,e,o,r)?(i=e,!0):!1}),i},u.first=function(e,t,n){return 0===e.length?null:u.isUndefined(t)?e[0]:u.find(e,t,n)},u.insert=function(e,t,n){return e.splice(n,0,t),e},u.all=function(e,t,n){var i,o,r=!0;for(o=0;e.length>o&&(i=e[o],r=r&&t.call(n,i,o,e),r);o++);return r},u.clear=function(e){e.splice(0,e.length)},u.bisort=function(e,t,n){if(u.isUndefined(e))throw"First array is not specified.";if(u.isUndefined(t))throw"Second array is not specified.";if(e.length!=t.length)throw"The two arrays should have equal length";var i,o=[];for(i=0;e.length>i;i++)o.push({x:e[i],y:t[i]});for(u.isUndefined(n)?o.sort(function(e,t){return e.x-t.x}):o.sort(function(e,t){return n(e.x,t.x)}),u.clear(e),u.clear(t),i=0;o.length>i;i++)e.push(o[i].x),t.push(o[i].y)},u.addRange=function(e,t){e.push.apply(e,t)},o={easeInOut:function(e){return-Math.cos(e*Math.PI)/2+.5}},r=a.Class.extend({init:function(){this.adapters=[],this.target=0,this.tick=0,this.interval=20,this.duration=800,this.lastTime=null,this.handlers=[];var e=this;this.transition=o.easeInOut,this.timerDelegate=function(){e.onTimerEvent()}},addAdapter:function(e){this.adapters.push(e)},onComplete:function(e){this.handlers.push(e)},removeHandler:function(t){this.handlers=e.grep(this.handlers,function(e){return e!==t})},trigger:function(){var e=this;this.handlers&&u.forEach(this.handlers,function(t){return t.call(null!==e.caller?e.caller:e)})},onStep:function(){},seekTo:function(e){this.seekFromTo(this.tick,e)},seekFromTo:function(e,t){this.target=Math.max(0,Math.min(1,t)),this.tick=Math.max(0,Math.min(1,e)),this.lastTime=(new Date).getTime(),this.intervalId||(this.intervalId=window.setInterval(this.timerDelegate,this.interval))},stop:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.trigger())},play:function(e){0!==this.adapters.length&&(null!==e&&(this.caller=e),this.initState(),this.seekFromTo(0,1))},reverse:function(){this.seekFromTo(1,0)},initState:function(){if(0!==this.adapters.length)for(var e=0;this.adapters.length>e;e++)this.adapters[e].initState()},propagate:function(){var e,t=this.transition(this.tick);for(e=0;this.adapters.length>e;e++)this.adapters[e].update(t)},onTimerEvent:function(){var e,t=(new Date).getTime(),n=t-this.lastTime;this.lastTime=t,e=n/this.duration*(this.target>this.tick?1:-1),Math.abs(e)>=Math.abs(this.tick-this.target)?this.tick=this.target:this.tick+=e;try{this.propagate()}finally{this.onStep.call(this),this.target==this.tick&&this.stop()}}}),a.deepExtend(s,{init:function(e){a.init(e,s.ui)},Utils:u,Range:n,Ticker:r})}(window.kendo.jQuery),function(e,t){function n(e){return Math.abs(e)<M}function i(e,t,i,o,r){var a,s,l,d,c=(t.x-e.x)*(o.y-i.y)-(t.y-e.y)*(o.x-i.x);if(!n(c)&&(a=(e.y-i.y)*(o.x-i.x)-(e.x-i.x)*(o.y-i.y),s=(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y),l=a/c,d=s/c,!r||!(0>l||l>1||0>d||d>1)))return new A(e.x+l*(t.x-e.x),e.y+l*(t.y-e.y))}function o(e,t){var n,i,o;do n=2*Math.random()-1,i=2*Math.random()-1,o=n*n+i*i;while(!o||o>1);return e+t*n*Math.sqrt(-2*Math.log(o)/o)}function r(e){var t,n,i;for(D.isUndefined(e)&&(e=10),t="",n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=e;i>0;--i)t+=n[Math.round(Math.random()*(n.length-1))];return t}var a,s,l,d,c,u,h,p,f,g,m,v,_,y,w,b,k=window.kendo,x=k.dataviz.diagram,C=k.Class,T=k.deepExtend,S=k.dataviz,D=x.Utils,A=S.Point2D,E=k.isFunction,P=D.contains,I=e.map,z=3,M=1e-6;T(A.fn,{plus:function(e){return new A(this.x+e.x,this.y+e.y)},minus:function(e){return new A(this.x-e.x,this.y-e.y)},offset:function(e){return new A(this.x-e,this.y-e)},times:function(e){return new A(this.x*e,this.y*e)},normalize:function(){return 0===this.length()?new A:this.times(1/this.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},toString:function(){return"("+this.x+","+this.y+")"},lengthSquared:function(){return this.x*this.x+this.y*this.y},middleOf:function(e,t){return new A(t.x-e.x,t.y-e.y).times(.5).plus(e)},toPolar:function(e){var t,n,i,o=1;if(e&&(o=180/Math.PI),t=Math.atan2(Math.abs(this.y),Math.abs(this.x)),n=Math.PI/2,i=this.length(),0===this.x){if(0===this.y)return new u(0,0);if(this.y>0)return new u(i,o*n);if(0>this.y)return new u(i,3*o*n)}else if(this.x>0){if(0===this.y)return new u(i,0);if(this.y>0)return new u(i,o*t);if(0>this.y)return new u(i,o*(4*n-t))}else{if(0===this.y)return new u(i,2*n);if(this.y>0)return new u(i,o*(2*n-t));if(0>this.y)return new u(i,o*(2*n+t))}},isOnLine:function(e,t){var n,i,o,r,a;return e.x>t.x&&(n=t,t=e,e=n),i=new s(e.x,e.y).inflate(z,z),o=new s(t.x,t.y).inflate(z,z),i.union(o).contains(this)?e.x===t.x||e.y===t.y?!0:(t.y>e.y?(r=i.x+(o.x-i.x)*(this.y-(i.y+i.height))/(o.y+o.height-(i.y+i.height)),a=i.x+i.width+(o.x+o.width-(i.x+i.width))*(this.y-i.y)/(o.y-i.y)):(r=i.x+(o.x-i.x)*(this.y-i.y)/(o.y-i.y),a=i.x+i.width+(o.x+o.width-(i.x+i.width))*(this.y-(i.y+i.height))/(o.y+o.height-(i.y+i.height))),this.x>r&&a>this.x):!1}}),T(A,{parse:function(e){var n=e.slice(1,e.length-1),i=n.split(","),o=parseInt(i[0],10),r=parseInt(i[1],10);return isNaN(o)||isNaN(r)?t:new A(o,r)}}),a=C.extend({init:function(e,t,n){this.point=e,this.left=t,this.right=n}}),s=C.extend({init:function(e,t,n,i){this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0},contains:function(e){return e.x>=this.x&&this.x+this.width>=e.x&&e.y>=this.y&&this.y+this.height>=e.y},inflate:function(e,n){return n===t&&(n=e),this.x-=e,this.y-=n,this.width+=2*e+1,this.height+=2*n+1,this},offset:function(e,t){var n=e,i=t;return e instanceof A&&(n=e.x,i=e.y),this.x+=n,this.y+=i,this},union:function(e){var t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),i=Math.max(this.x+this.width,e.x+e.width),o=Math.max(this.y+this.height,e.y+e.height);return new s(t,n,i-t,o-n)},center:function(){return new A(this.x+this.width/2,this.y+this.height/2)},top:function(){return new A(this.x+this.width/2,this.y)},right:function(){return new A(this.x+this.width,this.y+this.height/2)},bottom:function(){return new A(this.x+this.width/2,this.y+this.height)},left:function(){return new A(this.x,this.y+this.height/2)},topLeft:function(){return new A(this.x,this.y)},topRight:function(){return new A(this.x+this.width,this.y)},bottomLeft:function(){return new A(this.x,this.y+this.height)},bottomRight:function(){return new A(this.x+this.width,this.y+this.height)},clone:function(){return new s(this.x,this.y,this.width,this.height)},isEmpty:function(){return!this.width&&!this.height},equals:function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},rotatedBounds:function(e){var t=this.clone(),n=this.rotatedPoints(e),i=n[0],o=n[1],r=n[2],a=n[3];return t.x=Math.min(r.x,i.x,o.x,a.x),t.y=Math.min(r.y,i.y,o.y,a.y),t.width=Math.max(r.x,i.x,o.x,a.x)-t.x,t.height=Math.max(r.y,i.y,o.y,a.y)-t.y,t},rotatedPoints:function(e){var t=this,n=t.center(),i=t.bottomRight().rotate(n,360-e),o=t.topLeft().rotate(n,360-e),r=t.topRight().rotate(n,360-e),a=t.bottomLeft().rotate(n,360-e);return[o,r,i,a]},toString:function(e){return e=e||" ",this.x+e+this.y+e+this.width+e+this.height},scale:function(e,t,n,i,o){var r,a,s,l=this.topLeft(),d=this.center();l.rotate(d,360-o).rotate(i,o),r=n.minus(l),a=new A(r.x*e,r.y*t),s=r.minus(a),l=l.plus(s),l.rotate(i,360-o).rotate(d,o),this.x=l.x,this.y=l.y,this.width*=e,this.height*=t}}),l=C.extend({init:function(e,t){this.width=e,this.height=t}}),l.prototype.Empty=new l(0,0),s.toRect=function(e){return e instanceof s||(e=new s(e.x,e.y,e.width,e.height)),e},s.empty=function(){return new s(0,0,0,0)},s.fromPoints=function(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(t.x)||isNaN(t.y))throw"Some values are NaN.";return new s(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.abs(e.x-t.x),Math.abs(e.y-t.y))},d={lines:function(e,t,n,o){return i(e,t,n,o)},segments:function(e,t,n,o){return i(e,t,n,o,!0)},rectWithLine:function(e,t,n){return d.segments(t,n,e.topLeft(),e.topRight())||d.segments(t,n,e.topRight(),e.bottomRight())||d.segments(t,n,e.bottomLeft(),e.bottomRight())||d.segments(t,n,e.topLeft(),e.bottomLeft())},rects:function(e,t,n){var i,o,r=t.topLeft(),a=t.topRight(),s=t.bottomLeft(),l=t.bottomRight(),c=t.center();return n&&(r=r.rotate(c,n),a=a.rotate(c,n),s=s.rotate(c,n),l=l.rotate(c,n)),i=e.contains(r)||e.contains(a)||e.contains(s)||e.contains(l)||d.rectWithLine(e,r,a)||d.rectWithLine(e,r,s)||d.rectWithLine(e,a,l)||d.rectWithLine(e,s,l),i||(r=e.topLeft(),a=e.topRight(),s=e.bottomLeft(),l=e.bottomRight(),n&&(o=360-n,r=r.rotate(c,o),a=a.rotate(c,o),s=s.rotate(c,o),l=l.rotate(c,o)),i=t.contains(r)||t.contains(a)||t.contains(s)||t.contains(l)),i}},c=C.extend({init:function(e){this.container=s.toRect(e)},align:function(e,t){var n,i=t.toLowerCase().split(" ");for(n=0;i.length>n;n++)e=this._singleAlign(e,i[n]);return e},_singleAlign:function(e,t){return E(this[t])?this[t](e):e},left:function(e){return this._align(e,this._left)},center:function(e){return this._align(e,this._center)},right:function(e){return this._align(e,this._right)},stretch:function(e){return this._align(e,this._stretch)},top:function(e){return this._align(e,this._top)},middle:function(e){return this._align(e,this._middle)},bottom:function(e){return this._align(e,this._bottom)},_left:function(e,t){t.x=e.x},_center:function(e,t){t.x=(e.width-t.width)/2||0},_right:function(e,t){t.x=e.width-t.width},_top:function(e,t){t.y=e.y},_middle:function(e,t){t.y=(e.height-t.height)/2||0},_bottom:function(e,t){t.y=e.height-t.height},_stretch:function(e,t){t.x=0,t.y=0,t.height=e.height,t.width=e.width},_align:function(e,t){return e=s.toRect(e),t(this.container,e),e}}),u=C.extend({init:function(e,t){this.r=e,this.angle=t}}),h=C.extend({init:function(e,t,n,i,o,r){this.a=e||0,this.b=t||0,this.c=n||0,this.d=i||0,this.e=o||0,this.f=r||0},plus:function(e){this.a+=e.a,this.b+=e.b,this.c+=e.c,this.d+=e.d,this.e+=e.e,this.f+=e.f},minus:function(e){this.a-=e.a,this.b-=e.b,this.c-=e.c,this.d-=e.d,this.e-=e.e,this.f-=e.f},times:function(e){return new h(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.e+this.c*e.f+this.e,this.b*e.e+this.d*e.f+this.f)},apply:function(e){return new A(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)},applyRect:function(e){return s.fromPoints(this.apply(e.topLeft()),this.apply(e.bottomRight()))},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")"}}),T(h,{fromSVGMatrix:function(e){var t=new h;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t},fromMatrixVector:function(e){var t=new h;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t},fromList:function(e){if(6!==e.length)throw"The given list should consist of six elements.";var t=new h;return t.a=e[0],t.b=e[1],t.c=e[2],t.d=e[3],t.e=e[4],t.f=e[5],t},translation:function(e,t){var n=new h;return n.a=1,n.b=0,n.c=0,n.d=1,n.e=e,n.f=t,n},unit:function(){return new h(1,0,0,1,0,0)},rotation:function(e,t,n){var i=new h;return i.a=Math.cos(e*Math.PI/180),i.b=Math.sin(e*Math.PI/180),i.c=-i.b,i.d=i.a,i.e=t-t*i.a+n*i.b||0,i.f=n-n*i.a-t*i.b||0,i},scaling:function(e,t){var n=new h;return n.a=e,n.b=0,n.c=0,n.d=t,n.e=0,n.f=0,n},parse:function(e){var t,n;if(e){if(e=e.trim(),"matrix"===e.slice(0,6).toLowerCase()){if(n=e.slice(7,e.length-1).trim(),t=n.split(","),6===t.length)return h.fromList(I(t,function(e){return parseFloat(e)}));if(t=n.split(" "),6===t.length)return h.fromList(I(t,function(e){return parseFloat(e)}))}if("("===e.slice(0,1)&&")"===e.slice(e.length-1)&&(e=e.substr(1,e.length-1)),e.indexOf(",")>0&&(t=e.split(","),6===t.length))return h.fromList(I(t,function(e){return parseFloat(e)}));if(e.indexOf(" ")>0&&(t=e.split(" "),6===t.length))return h.fromList(I(t,function(e){return parseFloat(e)}))}return t}}),p=C.extend({init:function(e,t,n,i,o,r){this.a=e||0,this.b=t||0,this.c=n||0,this.d=i||0,this.e=o||0,this.f=r||0},fromMatrix:function(e){var t=new p;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t}}),f={_distanceToLineSquared:function(e,t,n){function i(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}if(t===n)return i(e,t);var o=n.x-t.x,r=n.y-t.y,a=(e.x-t.x)*o+(e.y-t.y)*r;return 0>a?i(t,e):(a=(n.x-e.x)*o+(n.y-e.y)*r,0>a?i(n,e):(a=(n.x-e.x)*r-(n.y-e.y)*o,a*a/(o*o+r*r)))},distanceToLine:function(e,t,n){return Math.sqrt(this._distanceToLineSquared(e,t,n))},distanceToPolyline:function(e,t){var n,i,o,r,a=Number.MAX_VALUE;if(D.isUndefined(t)||0===t.length)return Number.MAX_VALUE;for(n=0;t.length-1>n;n++)i=t[n],o=t[n+1],r=this._distanceToLineSquared(e,i,o),a>r&&(a=r);return Math.sqrt(a)}},g=k.Class.extend({init:function(){this._buckets=[],this.length=0},add:function(e,t){var n=this._createGetBucket(e);return D.isDefined(t)&&(n.value=t),n},get:function(e){return this._bucketExists(e)?this._createGetBucket(e):null},set:function(e,t){this.add(e,t)},containsKey:function(e){return this._bucketExists(e)},remove:function(e){if(this._bucketExists(e)){var t=this._hash(e);return delete this._buckets[t],this.length--,e}},forEach:function(e){var t,n,i,o,r=this._hashes();for(t=0,n=r.length;n>t;t++)i=r[t],o=this._buckets[i],D.isUndefined(o)||e(o)},clone:function(){var e,t,n,i,o=new g,r=this._hashes();for(e=0,t=r.length;t>e;e++)n=r[e],i=this._buckets[n],D.isUndefined(i)||o.add(i.key,i.value);return o},_hashes:function(){var e,t=[];for(e in this._buckets)this._buckets.hasOwnProperty(e)&&t.push(e);return t},_bucketExists:function(e){var t=this._hash(e);return D.isDefined(this._buckets[t])},_createGetBucket:function(e){var t=this._hash(e),n=this._buckets[t];return D.isUndefined(n)&&(n={key:e},this._buckets[t]=n,this.length++),n},_hash:function(e){if(D.isNumber(e))return e;if(D.isString(e))return this._hashString(e);if(D.isObject(e))return this._objectHashId(e);throw"Unsupported key type."},_hashString:function(e){var t,n,i=0;if(0===e.length)return i;for(t=0;e.length>t;t++)n=e.charCodeAt(t),i=32*i-i+n;return i},_objectHashId:function(e){var t=e._hashId;return D.isUndefined(t)&&(t=r(),e._hashId=t),t}}),m=k.Observable.extend({init:function(t){var n,i=this;if(k.Observable.fn.init.call(i),this._hashTable=new g,this.length=0,D.isDefined(t))if(e.isArray(t))for(n=0;t.length>n;n++)this.add(t[n]);else t.forEach(function(e,t){this.add(e,t)},this)},add:function(e,t){var n=this._hashTable.get(e);n||(n=this._hashTable.add(e),this.length++,this.trigger("changed")),n.value=t},set:function(e,t){this.add(e,t)},get:function(e){var t=this._hashTable.get(e);if(t)return t.value;throw Error("Cannot find key "+e)},containsKey:function(e){return this._hashTable.containsKey(e)},remove:function(e){return this.containsKey(e)?(this.trigger("changed"),this.length--,this._hashTable.remove(e)):t},forEach:function(e,t){this._hashTable.forEach(function(n){e.call(t,n.key,n.value)})},forEachValue:function(e,t){this._hashTable.forEach(function(n){e.call(t,n.value)})},forEachKey:function(e,t){this._hashTable.forEach(function(n){e.call(t,n.key)})},keys:function(){var e=[];return this.forEachKey(function(t){e.push(t)}),e}}),v=k.Class.extend({init:function(){this._tail=null,this._head=null,this.length=0},enqueue:function(e){var t={value:e,next:null};this._head?(this._tail.next=t,this._tail=this._tail.next):(this._head=t,this._tail=this._head),this.length++},dequeue:function(){if(1>this.length)throw Error("The queue is empty.");var e=this._head.value;return this._head=this._head.next,this.length--,e},contains:function(e){for(var t=this._head;t;){if(t.value===e)return!0;t=t.next}return!1}}),_=k.Observable.extend({init:function(e){var t=this;k.Observable.fn.init.call(t),this._hashTable=new g,this.length=0,D.isDefined(e)&&(e instanceof g?e.forEach(function(e){this.add(e)}):e instanceof m&&e.forEach(function(e,t){this.add({key:e,value:t})},this))},contains:function(e){return this._hashTable.containsKey(e)},add:function(e){var t=this._hashTable.get(e);t||(this._hashTable.add(e,e),this.length++,this.trigger("changed"))},get:function(e){return this.contains(e)?this._hashTable.get(e).value:null},hash:function(e){return this._hashTable._hash(e)},remove:function(e){this.contains(e)&&(this._hashTable.remove(e),this.length--,this.trigger("changed"))},forEach:function(e,t){this._hashTable.forEach(function(t){e(t.value)},t)},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),y=k.Class.extend({init:function(e,t){if(this.links=[],this.outgoing=[],this.incoming=[],this.weight=1,this.id=D.isDefined(e)?e:r(),D.isDefined(t)){this.associatedShape=t;var n=t.bounds();this.width=n.width,this.height=n.height,this.x=n.x,this.y=n.y}else this.associatedShape=null;this.data=null,this.type="Node",this.shortForm="Node '"+this.id+"'",this.isVirtual=!1},isIsolated:function(){return D.isEmpty(this.links)},bounds:function(e){return D.isDefined(e)?(this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,t):new x.Rect(this.x,this.y,this.width,this.height)},isLinkedTo:function(e){var t=this;return D.any(t.links,function(n){return n.getComplement(t)===e})},getChildren:function(){var e,t,n,i;if(0===this.outgoing.length)return[];for(e=[],t=0,n=this.outgoing.length;n>t;t++)i=this.outgoing[t],e.push(i.getComplement(this));return e},getParents:function(){var e,t,n,i;if(0===this.incoming.length)return[];for(e=[],t=0,n=this.incoming.length;n>t;t++)i=this.incoming[t],e.push(i.getComplement(this));return e},clone:function(){var e=new y;return D.isDefined(this.weight)&&(e.weight=this.weight),D.isDefined(this.balance)&&(e.balance=this.balance),D.isDefined(this.owner)&&(e.owner=this.owner),e.associatedShape=this.associatedShape,e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},adjacentTo:function(e){return null!==this.isLinkedTo(e)},removeLink:function(e){e.source===this&&(D.remove(this.links,e),D.remove(this.outgoing,e),e.source=null),e.target===this&&(D.remove(this.links,e),D.remove(this.incoming,e),e.target=null)},hasLinkTo:function(e){return D.any(this.outgoing,function(t){return t.target===e})},degree:function(){return this.links.length},incidentWith:function(e){return P(this.links,e)},getLinksWith:function(e){return D.all(this.links,function(t){return t.getComplement(this)===e},this)},getNeighbors:function(){var e=[];return D.forEach(this.incoming,function(t){e.push(t.getComplement(this))},this),D.forEach(this.outgoing,function(t){e.push(t.getComplement(this))},this),e}}),w=k.Class.extend({init:function(e,t,n,i){if(D.isUndefined(e))throw"The source of the new link is not set.";if(D.isUndefined(t))throw"The target of the new link is not set.";var o,a;o=D.isString(e)?new y(e):e,a=D.isString(t)?new y(t):t,this.source=o,this.target=a,this.source.links.push(this),this.target.links.push(this),this.source.outgoing.push(this),this.target.incoming.push(this),this.id=D.isDefined(n)?n:r(),this.associatedConnection=D.isDefined(i)?i:null,this.type="Link",this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'"},getComplement:function(e){if(this.source!==e&&this.target!==e)throw"The given node is not incident with this link.";return this.source===e?this.target:this.source},getCommonNode:function(e){return this.source===e.source||this.source===e.target?this.source:this.target===e.source||this.target===e.target?this.target:null},isBridging:function(e,t){return this.source===e&&this.target===t||this.source===t&&this.target===e},getNodes:function(){return[this.source,this.target]},incidentWith:function(e){return this.source===e||this.target===e},adjacentTo:function(e){return P(this.source.links,e)||P(this.target.links,e)},changeSource:function(e){D.remove(this.source.links,this),D.remove(this.source.outgoing,this),e.links.push(this),e.outgoing.push(this),this.source=e},changeTarget:function(e){D.remove(this.target.links,this),D.remove(this.target.incoming,this),e.links.push(this),e.incoming.push(this),this.target=e},changesNodes:function(e,t){this.source===e?this.changeSource(t):this.target===e&&this.changeTarget(t)},reverse:function(){var e=this.source,t=this.target;return this.source=t,D.remove(e.outgoing,this),this.source.outgoing.push(this),this.target=e,D.remove(t.incoming,this),this.target.incoming.push(this),this},directTo:function(e){if(this.source!==e&&this.target!==e)throw"The given node is not incident with this link.";this.target!==e&&this.reverse()},createReverseEdge:function(){var e=this.clone();return e.reverse(),e.reversed=!0,e},clone:function(){var e=new w(this.source,this.target);return e}}),b=k.Class.extend({init:function(e){this.links=[],this.nodes=[],this.diagram=null,this._root=null,D.isDefined(e)?D.isString(e)?this.id=e:(this.diagram=e,this.id=e.id):this.id=r(),this.bounds=new s,this._hasCachedRelationships=!1,this.type="Graph"},cacheRelationships:function(e){var t,n,i;if(D.isUndefined(e)&&(e=!1),!this._hasCachedRelationships||e){for(t=0,n=this.nodes.length;n>t;t++)i=this.nodes[t],i.children=this.getChildren(i),i.parents=this.getParents(i);this._hasCachedRelationships=!0}},assignLevels:function(e,t,n){var i,o,r,a;if(!e)throw"Start node not specified.";for(D.isUndefined(t)&&(t=0),this.cacheRelationships(),D.isUndefined(n)&&(n=new m,D.forEach(this.nodes,function(e){n.add(e,!1)})),n.set(e,!0),e.level=t,i=e.children,o=0,r=i.length;r>o;o++)a=i[o],a&&!n.get(a)&&this.assignLevels(a,t+1,n)},root:function(e){if(D.isUndefined(e)){if(this._root)return this._root;var t=D.first(this.nodes,function(e){return 0===e.incoming.length});return t?t:D.first(this.nodes)}this._root=e},getConnectedComponents:function(){var e,t,n,i,o;for(this.componentIndex=0,this.setItemIndices(),e=D.initArray(this.nodes.length,-1),t=0;this.nodes.length>t;t++)-1===e[t]&&(this._collectConnectedNodes(e,t),this.componentIndex++);for(n=[],i=0;this.componentIndex>i;++i)n[i]=new b;for(i=0;e.length>i;++i)o=n[e[i]],o.addNodeAndOutgoings(this.nodes[i]);return n.sort(function(e,t){return t.nodes.length-e.nodes.length}),n},_collectConnectedNodes:function(e,t){e[t]=this.componentIndex;var n=this.nodes[t];D.forEach(n.links,function(t){var i=t.getComplement(n),o=i.index;-1===e[o]&&this._collectConnectedNodes(e,o)},this)},calcBounds:function(){var e,t,n,i;if(this.isEmpty())return this.bounds=new s;for(e=null,t=0,n=this.nodes.length;n>t;t++)i=this.nodes[t],e=e?e.union(i.bounds()):i.bounds();return this.bounds=e},getSpanningTree:function(e){var t,n,i,o,r,a,s,l,d,c,u,h,p=new b,f=new m;for(p.root=e.clone(),p.root.level=0,p.root.id=e.id,f.add(e,p.root),e.level=0,i=[],o=[],p.nodes.push(p.root),i.push(e),o.push(e),r=1;o.length>0;)for(a=o.pop(),s=0;a.links.length>s;s++)l=a.links[s],d=l.getComplement(a),P(i,d)||(d.level=a.level+1,d.level+1>r&&(r=d.level+1),P(o,d)||o.push(d),P(i,d)||i.push(d),f.containsKey(a)?t=f.get(a):(t=a.clone(),t.level=a.level,t.id=a.id,f.add(a,t)),f.containsKey(d)?n=f.get(d):(n=d.clone(),n.level=d.level,n.id=d.id,f.add(d,n)),c=new w(t,n),p.addLink(c));for(u=[],h=0;r>h;h++)u.push([]);return D.forEach(p.nodes,function(e){u[e.level].push(e)}),p.treeLevels=u,p.cacheRelationships(),p},takeRandomNode:function(t,n){if(D.isUndefined(t)&&(t=[]),D.isUndefined(n)&&(n=4),0===this.nodes.length)return null;if(1===this.nodes.length)return P(t,this.nodes[0])?null:this.nodes[0];var i=e.grep(this.nodes,function(e){return!P(t,e)&&e.degree()<=n});return D.isEmpty(i)?null:i[D.randomInteger(0,i.length)]},isEmpty:function(){return D.isEmpty(this.nodes)},isHealthy:function(){return D.all(this.links,function(e){return P(this.nodes,e.source)&&P(this.nodes,e.target)},this)},getParents:function(e){if(!this.hasNode(e))throw"The given node is not part of this graph.";return e.getParents()},getChildren:function(e){if(!this.hasNode(e))throw"The given node is not part of this graph.";return e.getChildren()},addLink:function(e,n,i){var o,r,a;if(D.isUndefined(e))throw"The source of the link is not defined.";if(D.isUndefined(n)){if(D.isDefined(e.type)&&"Link"===e.type)return this.addExistingLink(e),t;throw"The target of the link is not defined."}return o=this.getNode(e),D.isUndefined(o)&&(o=this.addNode(e)),r=this.getNode(n),D.isUndefined(r)&&(r=this.addNode(n)),a=new w(o,r),D.isDefined(i)&&(a.owner=i),this.links.push(a),a},removeAllLinks:function(){for(;this.links.length>0;){var e=this.links[0];this.removeLink(e)}},addExistingLink:function(e){var t,n;this.hasLink(e)||(this.links.push(e),this.hasNode(e.source.id)?(t=this.getNode(e.source.id),e.changeSource(t)):this.addNode(e.source),this.hasNode(e.target.id)?(n=this.getNode(e.target.id),e.changeTarget(n)):this.addNode(e.target))},hasLink:function(e){if(D.isString(e))return D.any(this.links,function(t){return t.id===e});if("Link"===e.type)return P(this.links,e);throw"The given object is neither an identifier nor a Link."},getNode:function(e){if(D.isUndefined(e))throw"No identifier or Node specified.";return D.isString(e)?D.find(this.nodes,function(t){return t.id==e}):this.hasNode(e)?e:null},hasNode:function(e){if(D.isString(e))return D.any(this.nodes,function(t){return t.id===e});if(D.isObject(e))return D.any(this.nodes,function(t){return t===e});throw"The identifier should be a Node or the Id (string) of a node."},removeNode:function(e){var t,n,i,o,r=e;if(D.isString(e)&&(r=this.getNode(e)),!D.isDefined(r))throw"The identifier should be a Node or the Id (string) of a node.";for(t=r.links,r.links=[],n=0,i=t.length;i>n;n++)o=t[n],this.removeLink(o);D.remove(this.nodes,r)},areConnected:function(e,t){return D.any(this.links,function(n){return n.source==e&&n.target==t||n.source==t&&n.target==e})},removeLink:function(e){D.remove(this.links,e),D.remove(e.source.outgoing,e),D.remove(e.source.links,e),D.remove(e.target.incoming,e),D.remove(e.target.links,e)},addNode:function(e,t,n){var i=null;if(!D.isDefined(e))throw"No Node or identifier for a new Node is given.";if(D.isString(e)){if(this.hasNode(e))return this.getNode(e);i=new y(e)}else{if(this.hasNode(e))return this.getNode(e);i=e}return D.isDefined(t)&&i.bounds(t),D.isDefined(n)&&(i.owner=n),this.nodes.push(i),i},addNodeAndOutgoings:function(e){P(this.nodes,e)||this.nodes.push(e);var t=e.outgoing;e.outgoing=[],D.forEach(t,function(e){this.addExistingLink(e)},this)},setItemIndices:function(){var e;for(e=0;this.nodes.length>e;++e)this.nodes[e].index=e;for(e=0;this.links.length>e;++e)this.links[e].index=e},clone:function(e){var t,n=new b,i=D.isDefined(e)&&e===!0;return i&&(n.nodeMap=new m,n.linkMap=new m),t=new m,D.forEach(this.nodes,function(e){var o=e.clone();t.set(e,o),n.nodes.push(o),i&&n.nodeMap.set(o,e)}),D.forEach(this.links,function(e){if(t.containsKey(e.source)&&t.containsKey(e.target)){var o=n.addLink(t.get(e.source),t.get(e.target));i&&n.linkMap.set(o,e)}}),n},linearize:function(e){return b.Utils.linearize(this,e)},depthFirstTraversal:function(e,t){var n,i;if(D.isUndefined(e))throw"You need to supply a starting node.";if(D.isUndefined(t))throw"You need to supply an action.";if(!this.hasNode(e))throw"The given start-node is not part of this graph";n=this.getNode(e),i=[],this._dftIterator(n,t,i)},_dftIterator:function(e,t,n){var i,o,r,a;for(t(e),n.push(e),i=e.getChildren(),o=0,r=i.length;r>o;o++)a=i[o],P(n,a)||this._dftIterator(a,t,n)},breadthFirstTraversal:function(e,t){var n,i,o,r,a,s,l,d;if(D.isUndefined(e))throw"You need to supply a starting node.";if(D.isUndefined(t))throw"You need to supply an action.";if(!this.hasNode(e))throw"The given start-node is not part of this graph";for(n=this.getNode(e),i=new v,o=[],i.enqueue(n);i.length>0;)for(r=i.dequeue(),t(r),o.push(r),a=r.getChildren(),s=0,l=a.length;l>s;s++)d=a[s],P(o,d)||P(i,d)||i.enqueue(d)},_stronglyConnectedComponents:function(e,t,n,i,o,r,a){var s,l,d,c,u;for(n.add(t,a),i.add(t,a),a++,r.push(t),s=t.getChildren(),d=0,c=s.length;c>d;d++)l=s[d],n.containsKey(l)?P(r,l)&&i.add(t,Math.min(i.get(t),n.get(l))):(this._stronglyConnectedComponents(e,l,n,i,o,r,a),i.add(t,Math.min(i.get(t),i.get(l))));if(i.get(t)===n.get(t)){u=[];do l=r.pop(),u.push(l);while(l!==t);(!e||u.length>1)&&o.push(u)}},findCycles:function(e){var t,n,i,o,r,a,s;for(D.isUndefined(e)&&(e=!0),t=new m,n=new m,i=[],o=[],r=0,a=this.nodes.length;a>r;r++)s=this.nodes[r],t.containsKey(s)||this._stronglyConnectedComponents(e,s,t,n,i,o,0);return i},isAcyclic:function(){return D.isEmpty(this.findCycles())},isSubGraph:function(e){var t=e.linearize(),n=this.linearize();return D.all(t,function(e){return P(n,e)})},makeAcyclic:function(){var e,t,n,i,o,r,a,s,l,d,c,u,h,p,f,g,v,_,y,w,b,k,x,C,T,S,A,E,P,I,z,M;if(this.isEmpty()||1>=this.nodes.length||1>=this.links.length)return[];if(2==this.nodes.length){if(e=[],this.links.length>1)for(t=this.links[0],n=t.source,i=0,o=this.links.length;o>i;i++)r=this.links[i],r.source!=n&&(a=r.reverse(),e.push(a));return e}for(s=this.clone(!0),l=this.nodes.length,d=new m,c=function(e){return 0===e.outgoing.length?2-l:0===e.incoming.length?l-2:e.outgoing.length-e.incoming.length},u=function(e,t){var n=c(e,l);
t.containsKey(n)||t.set(n,[]),t.get(n).push(e)},D.forEach(s.nodes,function(e){u(e,d)}),h=[],p=[];s.nodes.length>0;){if(d.containsKey(2-l))for(_=d.get(2-l);_.length>0;){for(g=_.pop(),y=0;g.links.length>y;y++)w=g.links[y],f=w.getComplement(g),v=c(f,l),D.remove(d.get(v),f),f.removeLink(w),u(f,d);D.remove(s.nodes,g),p.unshift(g)}if(d.containsKey(l-2))for(b=d.get(l-2);b.length>0;){for(f=b.pop(),k=0;f.links.length>k;k++)x=f.links[k],g=x.getComplement(f),v=c(g,l),D.remove(d.get(v),g),g.removeLink(x),u(g,d);h.push(f),D.remove(s.nodes,f)}if(s.nodes.length>0)for(C=l-3;C>2-l;C--)if(d.containsKey(C)&&d.get(C).length>0){for(T=d.get(C),S=T.pop(),A=0;S.links.length>A;A++)E=S.links[A],P=E.getComplement(S),v=c(P,l),D.remove(d.get(v),P),P.removeLink(E),u(P,d);h.push(S),D.remove(s.nodes,S);break}}for(h=h.concat(p),I=new m,z=0;this.nodes.length>z;z++)I.set(s.nodeMap.get(h[z]),z);return M=[],D.forEach(this.links,function(e){I.get(e.source)>I.get(e.target)&&(e.reverse(),M.push(e))}),M}}),b.Predefined={EightGraph:function(){return b.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"])},Mindmap:function(){return b.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"])},ThreeGraph:function(){return b.Utils.parse(["1->2","2->3","3->1"])},BinaryTree:function(e){return D.isUndefined(e)&&(e=5),b.Utils.createBalancedTree(e,2)},Linear:function(e){return D.isUndefined(e)&&(e=10),b.Utils.createBalancedTree(e,1)},Tree:function(e,t){return b.Utils.createBalancedTree(e,t)},Forest:function(e,t,n){return b.Utils.createBalancedForest(e,t,n)},Workflow:function(){return b.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"])},Grid:function(e,t){var n,i,o,r,a,s=new x.Graph;if(0>=e&&0>=t)return s;for(n=0;e+1>n;n++)for(i=null,o=0;t+1>o;o++)r=new y(""+n+"."+o),s.addNode(r),i&&s.addLink(i,r),n>0&&(a=s.getNode(""+(n-1)+"."+o),s.addLink(a,r)),i=r;return s}},b.Utils={parse:function(e){var t,n,i,o,r,a=new x.Graph,s=e.slice();for(n=0,i=s.length;i>n;n++){if(o=s[n],D.isString(o)){if(o.indexOf("->")<0)throw"The link should be specified as 'a->b'.";if(r=o.split("->"),2!=r.length)throw"The link should be specified as 'a->b'.";t=new w(r[0],r[1]),a.addLink(t)}if(D.isObject(o)){if(!t)throw"Specification found before Link definition.";k.deepExtend(t,o)}}return a},linearize:function(e,t){var n,i,o,r;if(D.isUndefined(e))throw"Expected an instance of a Graph object in slot one.";for(D.isUndefined(t)&&(t=!1),n=[],i=0,o=e.links.length;o>i;i++)r=e.links[i],n.push(r.source.id+"->"+r.target.id),t&&n.push({id:r.id});return n},_addShape:function(e,t,n,i){return D.isUndefined(t)&&(t=new x.Point(0,0)),D.isUndefined(n)&&(n=r()),i=k.deepExtend({width:20,height:20,id:n,radius:10,background:"#778899",data:"circle",undoable:!1,x:t.x,y:t.y},i),e.addShape(i)},_addConnection:function(e,t,n,i){return e.connect(t,n,i)},createDiagramFromGraph:function(e,t,n,i){var o,r,a,l,d,c,u,h,p,f,g,m,v,_,y,w;if(D.isUndefined(e))throw"The diagram surface is undefined.";if(D.isUndefined(t))throw"No graph specification defined.";for(D.isUndefined(n)&&(n=!0),D.isUndefined(i)&&(i=!1),o=e.element.clientWidth||200,r=e.element.clientHeight||200,a=[],c=0,u=t.nodes.length;u>c;c++)l=t.nodes[c],h=l.position,D.isUndefined(h)&&(h=D.isDefined(l.x)&&D.isDefined(l.y)?new A(l.x,l.y):new A(D.randomInteger(10,o-20),D.randomInteger(10,r-20))),p={},"0"===l.id||i&&k.deepExtend(p,{width:150*Math.random()+20,height:80*Math.random()+50,data:"rectangle",background:"#778899"}),d=this._addShape(e,h,l.id,p),f=d.bounds(),D.isDefined(f)&&(l.x=f.x,l.y=f.y,l.width=f.width,l.height=f.height),a[l.id]=d;for(g=0;t.links.length>g;g++)m=t.links[g],v=a[m.source.id],D.isUndefined(v)||(_=a[m.target.id],D.isUndefined(_)||this._addConnection(e,v,_,{id:m.id}));if(n)for(y=new e.SpringLayout(e),y.layoutGraph(t,{limitToView:!1}),w=0;t.nodes.length>w;w++)l=t.nodes[w],d=a[l.id],d.bounds(new s(l.x,l.y,l.width,l.height))},createBalancedTree:function(e,t){var n,i,o,r,a,s,l,d,c,u;if(D.isUndefined(e)&&(e=3),D.isUndefined(t)&&(t=3),n=new x.Graph,i=-1,o=[],0>=e||0>=t)return n;for(a=new y(""+ ++i),n.addNode(a),n.root=a,o.push(a),s=0;e>s;s++){for(r=[],l=0;o.length>l;l++)for(d=o[l],c=0;t>c;c++)u=new y(""+ ++i),n.addLink(d,u),r.push(u);o=r}return n},createBalancedForest:function(e,t,n){var i,o,r,a,s,l,d,c,u,h,p;if(D.isUndefined(e)&&(e=3),D.isUndefined(t)&&(t=3),D.isUndefined(n)&&(n=5),i=new x.Graph,o=-1,r=[],0>=e||0>=t||0>=n)return i;for(s=0;n>s;s++)for(l=new y(""+ ++o),i.addNode(l),r=[l],d=0;e>d;d++){for(a=[],c=0;r.length>c;c++)for(u=r[c],h=0;t>h;h++)p=new y(""+ ++o),i.addLink(u,p),a.push(p);r=a}return i},createRandomConnectedGraph:function(e,t,n){var i,o,r,a,s,l,d,c,u,h;if(D.isUndefined(e)&&(e=40),D.isUndefined(t)&&(t=4),D.isUndefined(n)&&(n=!1),i=new x.Graph,o=-1,0>=e)return i;if(r=new y(""+ ++o),i.addNode(r),1===e)return i;if(e>1){for(a=1;e>a&&(s=i.takeRandomNode([],t),s);a++)l=i.addNode(""+a),i.addLink(s,l);if(!n&&e>1)for(d=D.randomInteger(1,e),c=0;d>c;c++)u=i.takeRandomNode([],t),h=i.takeRandomNode([],t),u&&h&&!i.areConnected(u,h)&&i.addLink(u,h);return i}},randomDiagram:function(e,t,n,i,o){var r=e.Graph.Utils.createRandomConnectedGraph(t,n,i);b.Utils.createDiagramFromGraph(e,r,!1,o)}},k.deepExtend(x,{init:function(e){k.init(e,x.ui)},Point:A,Intersect:d,Geometry:f,Rect:s,Size:l,RectAlign:c,Matrix:h,MatrixVector:p,normalVariable:o,randomId:r,Dictionary:m,HashTable:g,Queue:v,Set:_,Node:y,Link:w,Graph:b,PathDefiner:a})}(window.kendo.jQuery),function(e,t){function n(e){var t=e._originWidth?e.options.width/e._originWidth:1,n=e._originHeight?e.options.height/e._originHeight:1,r=e.options.x||0,a=e.options.y||0;e._transform.translate=new o(r,a),e._transform.scale=new i(t,n),e._renderTransform()}var i,o,r,a,s,l,d,c,u,h,p,f,g,m,v,_,y,w,b,k=window.kendo,x=k.Observable,C=k.dataviz.diagram,T=k.Class,S=k.deepExtend,D=k.dataviz,A=C.Point,E=C.Rect,P=C.RectAlign,I=C.Matrix,z=C.Utils,M=z.isUndefined,F=C.MatrixVector,L="http://www.w3.org/2000/svg",B="http://www.w3.org/1999/xlink",R={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},H=360;C.Markers=R,i=T.extend({init:function(e,t){this.x=e,this.y=t},toMatrix:function(){return I.scaling(this.x,this.y)},toString:function(){return k.format("scale({0},{1})",this.x,this.y)},invert:function(){return new i(1/this.x,1/this.y)}}),o=T.extend({init:function(e,t){this.x=e,this.y=t},toMatrixVector:function(){return new F(0,0,0,0,this.x,this.y)},toMatrix:function(){return I.translation(this.x,this.y)},toString:function(){return k.format("translate({0},{1})",this.x,this.y)},plus:function(e){this.x+=e.x,this.y+=e.y},times:function(e){this.x*=e,this.y*=e},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){0!==this.Length&&this.times(1/this.length())},invert:function(){return new o(-this.x,-this.y)}}),r=T.extend({init:function(e,t,n){this.x=t||0,this.y=n||0,this.angle=e},toString:function(){return this.x&&this.y?k.format("rotate({0},{1},{2})",this.angle,this.x,this.y):k.format("rotate({0})",this.angle)},toMatrix:function(){return I.rotation(this.angle,this.x,this.y)},center:function(){return new A(this.x,this.y)},invert:function(){return new r(H-this.angle,this.x,this.y)}}),r.create=function(e){return new r(e.angle,e.x,e.y)},r.parse=function(e){var t=e.slice(1,e.length-1).split(","),n=t[0],i=t[1],o=t[2],a=new r(n,i,o);return a},a=T.extend({init:function(e,n,a,s,l,d){this.translate=new o(e,n),a!==t&&s!==t&&(this.scale=new i(a,s)),l!==t&&(this.rotate=d?new r(l,d.x,d.y):new r(l))},toString:function(){var e=function(e){return e?""+e:""};return e(this.translate)+e(this.rotate)+e(this.scale)},render:function(e){e.setAttribute("transform",""+this)},toMatrix:function(){var e=I.unit();return this.translate&&(e=e.times(this.translate.toMatrix())),this.rotate&&(e=e.times(this.rotate.toMatrix())),this.scale&&(e=e.times(this.scale.toMatrix())),e},invert:function(){var e,n,i=this.rotate?this.rotate.invert():t,r=i?i.toMatrix():I.unit(),s=this.scale?this.scale.invert():t,l=s?s.toMatrix():I.unit(),d=new A(-this.translate.x,-this.translate.y);return d=r.times(l).apply(d),e=new o(d.x,d.y),n=new a,n.translate=e,n.rotate=i,n.scale=s,n}}),s=T.extend({init:function(e,t){var n=this;this._originSize=E.empty(),this._visible=!0,this._transform=new a,n.domElement=e,n.options=S({},n.options,t),n.redraw()},visible:function(e){return M(e)?this._visible:(this._visible=e,this.domElement.setAttribute("visibility",e?"visible":"hidden"),t)},setAtr:function(e,n){M(n)||M(this.options[n])||this.options[n]!==t&&this.domElement.setAttribute(e,this.options[n])},redraw:function(e){e&&S(this.options,e),this.setAtr("id","id")},position:function(e,n){return n!==t?(this.options.x=e,this.options.y=n,this._pos=new A(e,n)):e instanceof A&&(this._pos=e,this.options.x=this._pos.x,this.options.y=this._pos.y),this._transform.translate=new o(this.options.x,this.options.y),this._renderTransform(),this._pos},rotate:function(e,n){return e!==t&&(this._transform.rotate=new r(e,n.x,n.y),this._renderTransform()),this._transform.rotate||new r(0)},_renderTransform:function(){this._transform.render(this.domElement)},_hover:function(){},_measure:function(e){var t,n=this.domElement;if(!this._measured||e)try{if(t=n.getBBox(),t.width&&t.height)return this._originSize=new E(t.left,t.right,t.width,t.height),this._originWidth=t.width,this._originHeight=t.height,this._measured=!0,this._originSize}catch(i){}}}),l=s.extend({init:function(e,t){var n=this;s.fn.init.call(n,e,t),e._kendoElement=this},options:{stroke:{color:"gray",width:1,dashType:"none"}},background:function(e){e!==t&&(this.options.background=e),this._background(this.options.background)},redraw:function(e){var t=this;s.fn.redraw.call(t,e),t._setStroke(),t.setAtr("fill-opacity","fillOpacity"),t.background()},_setStroke:function(){var e=this.options.stroke||{};this.domElement.setAttribute("stroke",e.color),this.domElement.setAttribute("stroke-dasharray",this._renderDashType()),this.domElement.setAttribute("stroke-width",e.width)},_renderDashType:function(){var e,t,n,i=this.options.stroke||{},o=i.width||1,r=i.dashType;if(r&&"solid"!=r){for(e=D.DASH_ARRAYS[r.toLowerCase()]||[],t=[],n=0;e.length>n;n++)t.push(e[n]*o);return t.join(" ")}},_hover:function(e){var t=this.options.background;e&&z.isDefined(this.options.hover.background)&&(t=this.options.hover.background),this._background(t)},_background:function(e){this.domElement.setAttribute("fill",this._getColor(e))},_getColor:function(e){var t,n;return"none"!=e?(n=new D.Color(e),t=n.toHex()):t=e,t}}),d=l.extend({init:function(e,t){var n=this;l.fn.init.call(n,e,t)},redraw:function(e){var n=this;l.fn.redraw.call(n,e),n.options.x!==t&&n.options.y!==t&&n.position(n.options.x,n.options.y),n.size()},size:function(e){return e!==t&&(this.options.width=e.width,this.options.height=e.height),this._sz={width:this.options.width,height:this.options.height},this.setAtr("width","width"),this.setAtr("height","height"),this.setAtr("background","background"),this._sz}}),c=l.extend({init:function(e){var t=this;d.fn.init.call(t,document.createElementNS(L,"text"),e),this.domElement.setAttribute("dominant-baseline","hanging")},options:{stroke:{color:"none",width:0,dashType:"none"},fontSize:15,fontVariant:"normal",fontWeight:"normal",anchor:"middle",background:"black",align:""},content:function(e){return e!==t&&(this.domElement.textContent=this.options.text=e,this._align()),this.options.text},redraw:function(e){d.fn.redraw.call(this,e),this.setAtr("font-family","fontFamily"),this.setAtr("font-variant","fontVariant"),this.setAtr("font-size","fontSize"),this.setAtr("font-weight","fontWeight"),this.setAtr("font-style","fontStyle"),this.setAtr("text-decoration","textDecoration"),this.setAtr("fill","color"),this.content(this.options.text)},size:function(){n(this)},bounds:function(){var e=this.options,t=new E(0,0,e.width,e.height);return t},align:function(e){this.options.align=e,this._align(e)},_align:function(){if(this.options.align){this._measure(!0);var e=this.options,t=this.bounds(),n=new P(t),i=n.align(this._originSize,e.align);this.position(i.topLeft()),e.width=i.width,e.height=i.height,this.size()}}}),u=x.extend({init:function(e,t){x.fn.init.call(this);var n=this;n.domElement=e||this._createEditor(),n.options=S({},n.options,t),n.redraw()},visible:function(e){return e!==t&&(this._isVisible=e,this.domElement.style.visibility=e?"visible":"hidden"),this._isVisible},position:function(n,i){return i!==t?(this.options.x=n,this.options.y=i,this._pos=new A(n,i)):n instanceof A&&(this._pos=n,this.options.x=this._pos.x,this.options.y=this._pos.y),e(this.domElement).css({left:this._pos.x+"px",top:this._pos.y+"px"}),this._pos},size:function(n,i){var o=!1;return i!==t?(this._size={width:n,height:i},o=!0):n===Object(n)&&(this._size={width:n.width,height:n.height},o=!0),o&&(S(this.options,this._size),e(this.domElement).css({width:this._size.width+"px",height:this._size.height+"px"})),this._size},focus:function(){e(this.domElement).focus()},content:function(e){return M(e)||(this.domElement.value=this.options.text=e),this.domElement.value},redraw:function(e){this.options=S(this.options,e),this.content(this.options.text)},_createEditor:function(){var t=this,n=e("<input type='text' class='textEditable' />").css({position:"absolute",zIndex:100,fontSize:"16px"}).on("mousedown mouseup click dblclick",function(e){e.stopPropagation()}).on("keydown",function(e){e.stopPropagation()}).on("keypress",function(e){e.keyCode==k.keys.ENTER&&t.trigger("finishEdit",e),e.stopPropagation()}).on("focusout",function(e){t.trigger("finishEdit",e),e.stopPropagation()});return n[0]}}),h=d.extend({init:function(e){d.fn.init.call(this,document.createElementNS(L,"rect"),e)},options:{stroke:{},background:"none"},redraw:function(e){d.fn.redraw.call(this,e),this.setAtr("rx","cornerRadius"),this.setAtr("ry","cornerRadius"),this._setStroke()}}),p=l.extend({init:function(e){var t=this;l.fn.init.call(t,document.createElementNS(L,"path"),e)},options:{autoSize:!0},data:function(e){return e?(this.options.data=e,t):this.options.data},size:function(){n(this)},redraw:function(e){var t=this;l.fn.redraw.call(t,e),t.size(),t.setAtr("d","data"),this.options.startCap&&this.options.startCap!==R.none?this.domElement.setAttribute("marker-start","url(#"+this.options.startCap+")"):this.domElement.removeAttribute("marker-start"),this.options.endCap&&this.options.endCap!==R.none?this.domElement.setAttribute("marker-end","url(#"+this.options.endCap+")"):this.domElement.removeAttribute("marker-end"),this.domElement.parentNode&&-1!=navigator.appVersion.indexOf("MSIE 10")&&this.domElement.parentNode.insertBefore(this.domElement,this.domElement)}}),f=s.extend({init:function(e){var t,n,i=this;s.fn.init.call(i,document.createElementNS(L,"marker"),e),n=i.options,n.path?t=new p(n.path):n.circle&&(t=new w(n.circle)),t&&this.domElement.appendChild(t.domElement)},redraw:function(e){s.fn.redraw.call(this,e);var t=this,n=t.options;n.ref&&(t.domElement.refX.baseVal.value=n.ref.x,t.domElement.refY.baseVal.value=n.ref.y),n.width&&(t.domElement.markerWidth.baseVal.value=n.width),n.height&&(t.domElement.markerHeight.baseVal.value=n.height),this.setAtr("orient","orientation"),this.setAtr("viewBox","viewBox")}}),g=s.extend({init:function(e){var t,n,i=this;s.fn.init.call(i,document.createElementNS(L,"mask"),e),n=i.options,n.path?t=new p(n.path):n.circle?t=new w(n.circle):n.rectangle&&(t=new h(n.rectangle)),t&&this.domElement.appendChild(t.domElement),this.setAtr("id","id")},redraw:function(e){s.fn.redraw.call(this,e);var t=this,n=t.options;n.width&&(t.domElement.width.baseVal.value=n.width),n.height&&(t.domElement.height.baseVal.value=n.height)}}),m=l.extend({init:function(e){l.fn.init.call(this,document.createElementNS(L,"line"),e),this.options.from=this.options.from||new A,this.options.to=this.options.to||new A},redraw:function(e){l.fn.redraw.call(this,e),this.options.from&&(this.domElement.setAttribute("x1",""+this.options.from.x),this.domElement.setAttribute("y1",""+this.options.from.y)),this.options.to&&(this.domElement.setAttribute("x2",""+this.options.to.x),this.domElement.setAttribute("y2",""+this.options.to.y)),this.options.startCap&&this.options.startCap!==R.none?this.domElement.setAttribute("marker-start","url(#"+this.options.startCap+")"):this.domElement.removeAttribute("marker-start"),this.options.endCap&&this.options.endCap!==R.none?this.domElement.setAttribute("marker-end","url(#"+this.options.endCap+")"):this.domElement.removeAttribute("marker-end"),this.domElement.parentNode&&-1!=navigator.appVersion.indexOf("MSIE 10")&&this.domElement.parentNode.insertBefore(this.domElement,this.domElement)}}),v=l.extend({init:function(e){var t=this;l.fn.init.call(t,document.createElementNS(L,"polyline"),e),z.isDefined(e)&&null!==e.points&&this.points(t.options.points),this.background("none")},refresh:function(){if(null!==this._points&&0!==this._points.length){var e,t="";for(e=0;this._points.length>e;e++)t+=" "+this._points[e].x+","+this._points[e].y;this.domElement.setAttribute("points",t.trim()),this.domElement.setAttribute("stroke","Orange"),this.domElement.setAttribute("stroke-width","5")}},points:function(e){return M(e)?this._points:(this._points=e,this.refresh(),t)},redraw:function(){this.refresh()},options:{stroke:{color:"gray",width:1},backgrounds:"none",points:[]}}),_=s.extend({init:function(e){s.fn.init.call(this,document.createElementNS(L,"image"),e)},options:{autoSize:!0},redraw:function(e){s.fn.redraw.call(this,e),this.domElement.setAttributeNS(B,"href",this.options.source),this.setAtr("width","width"),this.setAtr("height","height"),this.setAtr("x","x"),this.setAtr("y","y")}}),y=s.extend({init:function(e){s.fn.init.call(this,document.createElementNS(L,"g"),e),this.width=this.options.width,this.height=this.options.height},options:{autoSize:!0},append:function(e){this.domElement.appendChild(e.domElement),e.canvas=this.canvas},remove:function(e){e.domElement?this.domElement.removeChild(e.domElement):this.domElement.removeChild(e)},clear:function(){for(;this.domElement.lastChild;)this.domElement.removeChild(this.domElement.lastChild)},toFront:function(e){var t,n,i=this.domElement;for(n=0;e.length>n;n++)t=e[n],i.appendChild(t.domElement)},toBack:function(e){var t,n;for(n=0;e.length>n;n++)t=e[n],this.domElement.insertBefore(t.domElement,this.domElement.firstChild)},toIndex:function(e,t){var n,i,o;for(i=0;e.length>i;i++)n=e[i],o=t[i],this.domElement.insertBefore(n.domElement,this.domElement.children[o])},size:function(){n(this)},redraw:function(e){s.fn.redraw.call(this,e),this.size()}}),w=l.extend({init:function(e){var t=this;e&&e.radius&&(e.width=2*e.radius,e.height=2*e.radius),l.fn.init.call(t,document.createElementNS(L,"ellipse"),e)},redraw:function(e){e&&z.isNumber(e.width)&&z.isNumber(e.height)&&(e.center=new A(e.width/2,e.height/2)),l.fn.redraw.call(this,e);var t=this.domElement,n=this.options,i=n.width/2||n.rx,o=n.height/2||n.rx;i&&o&&(t.rx.baseVal.value=i,t.ry.baseVal.value=o),n.center?(t.cx.baseVal.value=n.center.x,t.cy.baseVal.value=n.center.y):z.isDefined(n.x)&&z.isDefined(n.y)?(t.cx.baseVal.value=n.x+i,t.cy.baseVal.value=n.y+o):(t.cx.baseVal.value=i,t.cy.baseVal.value=o)}}),b=d.extend({init:function(t,n){var i=this;d.fn.init.call(i,document.createElementNS(L,"svg"),n),this.markers=[],this.gradients=[],this.visuals=[],this.defsNode=document.createElementNS(L,"defs"),this.domElement.appendChild(this.defsNode),this.element=t.context?t.context:t,e(this.domElement).css({width:this.options.width,height:this.options.height}),this.element.appendChild(i.domElement),this.domElement.style.background=i.options.background,this.domElement.setAttribute("xmlns",L),this.domElement.setAttribute("xmlns:xlink",B),this.element.setAttribute("tabindex","0"),this._markers(),this.masks=[]},options:{width:"100%",height:"100%",background:"none",id:"SVGRoot"},bounds:function(){var e=this.domElement.getBBox();return new E(0,0,e.width,e.height)},focus:function(){this.element.focus()},size:function(){var e=this,t=d.fn.size.apply(e,arguments),n=this.viewBox();return this._styledSize(e.domElement),n.width=t.width,n.height=t.height,this.viewBox(n),t},_styledSize:function(t){var n=this._sz;e(t).css(n)},viewBox:function(e){var n=this;return M(e)?n.domElement.viewBox.baseVal?E.toRect(n.domElement.viewBox.baseVal):E.empty():(e=E.toRect(e),isNaN(e.width)||isNaN(e.height)||this.domElement.setAttribute("viewBox",e.toString(",")),t)},append:function(e){return this.domElement.appendChild(e.domElement),e.canvas=this,this.visuals.push(e),this},remove:function(e){return z.indexOf(this.visuals,e)>=0?(this.domElement.removeChild(e.domElement),e.canvas=t,z.remove(this.visuals,e),this):t},insertBefore:function(e,t){return this.domElement.insertBefore(e.domElement,t.domElement),e.canvas=this,this.visuals.push(e),this},addMarker:function(e){this.defsNode.appendChild(e.domElement),this.markers.push(e)},removeMarker:function(e){e&&z.contains.contains(this.markers,e)&&(this.defsNode.removeChild(e.domElement),z.remove(this.markers,e))},addMask:function(e){this.defsNode.appendChild(e.domElement),this.masks.push(e)},removeMask:function(e){e&&z.contains(this.masks,e)&&(this.defsNode.removeChild(e.domElement),z.remove(this.masks,e))},removeGradient:function(e){e&&z.contains(this.gradients,e)&&(this.defsNode.removeChild(e.domElement),z.remove(this.gradients,e))},addGradient:function(e){this.defsNode.appendChild(e.domElement),this.gradients.push(e)},clearMarkers:function(){var e;if(0!==this.markers.length){for(e=0;this.markers.length>e;e++)this.defsNode.removeChild(this.markers[e].domElement);this.markers=[]}},clear:function(){for(;this.visuals.length;)this.remove(this.visuals[0])},mask:function(e){null===e?this.domElement.removeAttribute("mask"):this.domElement.setAttribute("mask","url(#"+e.domElement.id+")")},_markers:function(){this.addMarker(new f({path:{data:"M 0 0 L 10 5 L 0 10 L 3 5 z",background:"Black"},id:R.arrowEnd,orientation:"auto",width:10,height:10,ref:new A(10,5)})),this.addMarker(new f({path:{data:"M 0 5 L 10 0 L 7 5 L 10 10 z",background:"Black"},id:R.arrowStart,orientation:"auto",width:10,height:10,ref:new A(0,5)})),this.addMarker(new f({circle:{width:6,height:6,center:new A(5,5),stroke:{width:1},background:"black"},width:10,height:10,id:R.filledCircle,ref:new A(5,5),orientation:"auto"}))},destroy:function(t){t&&e(this.element).remove()}}),k.deepExtend(C,{init:function(e){k.init(e,C.ui)},Scale:i,Translation:o,Rotation:r,Circle:w,Group:y,Rectangle:h,Canvas:b,Path:p,Line:m,Marker:f,Polyline:v,CompositeTransform:a,TextBlock:c,TextBlockEditor:u,Image:_,Mask:g,Visual:d,VisualBase:l})}(window.kendo.jQuery),function(e,t){function n(e,t){e.isSelected?t.ctrlKey&&e.select(!1):e.diagram.select(e,{addToSelection:t.ctrlKey})}function i(e,t){return t.charCodeAt(0)==e||t.toUpperCase().charCodeAt(0)==e}function o(e,t){var n;return-1==e.x&&-1==e.y?n=t.bottomRight():1==e.x&&1==e.y?n=t.topLeft():-1==e.x&&1==e.y?n=t.topRight():1==e.x&&-1==e.y?n=t.bottomLeft():0===e.x&&-1==e.y?n=t.bottom():0===e.x&&1==e.y?n=t.top():1==e.x&&0===e.y?n=t.left():-1==e.x&&0===e.y&&(n=t.right()),n}var r,a,s,l,d,c,u,h,p,f,g,m,v,_,y,w,b,k,x,C,T,S,D,A,E,P,I,z,M,F,L,B,R,H,O,N=window.kendo,V=N.dataviz.diagram,U=N.Class,W=V.Group,j=V.TextBlock,q=V.Rect,G=V.Rectangle,Y=V.Utils,Q=Y.isUndefined,K=V.Point,$=V.Circle,X=V.Path,Z=V.Ticker,J=N.deepExtend,et=N.ui.Movable,tt={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},nt=10,it="Auto",ot="Top",rt="Right",at="Left",st="Bottom",lt=[ot,rt,st,at,it],dt="itemRotate",ct="itemBoundsChange",ut="zoomStart",ht="zoomEnd",pt=-2e4,ft=2e4;V.Cursors=tt,r=N.Class.extend({init:function(e){this.layoutState=e,this.diagram=e.diagram},initState:function(){function e(e,t){var n=this.diagram.getShapeById(e);n&&(this.subjects.push(n),this.froms.push(n.bounds().topLeft()),this.tos.push(t.topLeft()))}this.froms=[],this.tos=[],this.subjects=[],this.layoutState.nodeMap.forEach(e,this)},update:function(e){if(!(0>=this.subjects.length))for(var t=0;this.subjects.length>t;t++)this.subjects[t].position(new K(this.froms[t].x+(this.tos[t].x-this.froms[t].x)*e,this.froms[t].y+(this.tos[t].y-this.froms[t].y)*e))}}),a=U.extend({init:function(e,t,n){this.animate=Q(n)?!1:n,this._initialState=e,this._finalState=t,this.title="Diagram layout"},undo:function(){this.setState(this._initialState)},redo:function(){this.setState(this._finalState)},setState:function(e){var t,n=e.diagram;this.animate?(e.linkMap.forEach(function(e,t){var i=n.getShapeById(e);i.visible(!1),i&&i.points(t)}),t=new Z,t.addAdapter(new r(e)),t.onComplete(function(){e.linkMap.forEach(function(e){var t=n.getShapeById(e);t.visible(!0)})}),t.play()):(e.nodeMap.forEach(function(e,t){var i=n.getShapeById(e);i&&i.position(t.topLeft())}),e.linkMap.forEach(function(e,t){var i=n.getShapeById(e);i&&i.points(t)}))}}),s=U.extend({init:function(e){this.units=[],this.title="Composite unit",e!==t&&this.units.push(e)},add:function(e){this.units.push(e)},undo:function(){for(var e=0;this.units.length>e;e++)this.units[e].undo()},redo:function(){for(var e=0;this.units.length>e;e++)this.units[e].redo()}}),l=U.extend({init:function(e,t,n){this.item=e,this._undoContent=t,this._redoContent=n,this.title="Content Editing",this.rebuild=this.item.options.hasOwnProperty("rebuild")?this.item.options.rebuild:null},undo:function(){this.item.content(this._undoContent),this.rebuild&&this.rebuild.call(this.item,this.item)},redo:function(){this.item.content(this._redoContent),this.rebuild&&this.rebuild.call(this.item,this.item)}}),d=U.extend({init:function(e,t,n){this.item=e,this._redoSource=t,this._redoTarget=n,this._undoSource=e.source(),this._undoTarget=e.target(),this.title="Connection Editing"},undo:function(){this._undoSource!==t&&this.item.source(this._undoSource,!1),this._undoTarget!==t&&this.item.target(this._undoTarget,!1)},redo:function(){this._redoSource!==t&&this.item.source(this._redoSource,!1),this._redoTarget!==t&&this.item.target(this._redoTarget,!1)}}),c=U.extend({init:function(e,t,n){this.item=e,this._undoSource=t,this._undoTarget=n,this._redoSource=e.source(),this._redoTarget=e.target(),this.title="Connection Editing"},undo:function(){this.item.source(this._undoSource,!1),this.item.target(this._undoTarget,!1)},redo:function(){this.item.source(this._redoSource,!1),this.item.target(this._redoTarget,!1)}}),u=U.extend({init:function(e){this.connection=e,this.diagram=e.diagram,this.targetConnector=e.targetConnector,this.title="Delete connection"},undo:function(){this.diagram.addConnection(this.connection,!1)},redo:function(){this.diagram.remove(this.connection,!1)}}),h=U.extend({init:function(e){this.shape=e,this.diagram=e.diagram,this.title="Deletion"},undo:function(){this.diagram.addShape(this.shape,{undoable:!1}),this.shape.select(!1)},redo:function(){this.shape.select(!1),this.diagram.remove(this.shape,!1)}}),p=U.extend({init:function(e,t,n){var i,o;for(this.shapes=e,this.undoStates=t,this.title="Transformation",this.redoStates=[],this.adorner=n,i=0;this.shapes.length>i;i++)o=this.shapes[i],this.redoStates.push(o.bounds())},undo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.bounds(this.undoStates[e]),t.hasOwnProperty("layout")&&t.layout(t,this.redoStates[e],this.undoStates[e]);this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())},redo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.bounds(this.redoStates[e]),t.hasOwnProperty("layout")&&t.layout(t,this.undoStates[e],this.redoStates[e]);this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())}}),f=U.extend({init:function(e,t){this.connection=e,this.diagram=t,this.title="New connection"},undo:function(){this.diagram.remove(this.connection,!1)},redo:function(){this.diagram.addConnection(this.connection,!1)}}),g=U.extend({init:function(e,t){this.shape=e,this.diagram=t,this.title="New shape"},undo:function(){this.diagram.remove(this.shape,!1)},redo:function(){this.diagram.addShape(this.shape,{undoable:!1})}}),m=U.extend({init:function(e,t,n){this.initial=e,this.finalPos=t,this.diagram=n,this.title="Pan Unit"},undo:function(){this.diagram.pan(this.initial)},redo:function(){this.diagram.pan(this.finalPos)}}),v=U.extend({init:function(e,t,n){var i,o;for(this.shapes=t,this.undoRotates=n,this.title="Rotation",this.redoRotates=[],this.redoAngle=e._angle,this.adorner=e,this.center=e._innerBounds.center(),i=0;this.shapes.length>i;i++)o=this.shapes[i],this.redoRotates.push(o.rotate().angle)},undo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.rotate(this.undoRotates[e],this.center),t.hasOwnProperty("layout")&&t.layout(t);this.adorner&&(this.adorner._initialize(),this.adorner.refresh())},redo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.rotate(this.redoRotates[e],this.center),t.hasOwnProperty("layout")&&t.layout(t);this.adorner&&(this.adorner._initialize(),this.adorner.refresh())}}),_=U.extend({init:function(e,t,n){this.diagram=e,this.indices=n,this.items=t,this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toFront(this.items,!1)}}),y=U.extend({init:function(e,t,n){this.diagram=e,this.indices=n,this.items=t,this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toBack(this.items,!1)}}),w=U.extend({init:function(){this.stack=[],this.index=0,this.capacity=100},begin:function(){this.composite=new s},cancel:function(){this.composite=t},commit:function(){this.composite.units.length>0&&this._restart(this.composite),this.composite=t},addCompositeItem:function(e){this.composite?this.composite.add(e):this.add(e)},add:function(e,t){this._restart(e,t)},count:function(){return this.stack.length},undo:function(){this.index>0&&(this.index--,this.stack[this.index].undo())},redo:function(){this.stack.length>0&&this.stack.length>this.index&&(this.stack[this.index].redo(),this.index++)},_restart:function(e,t){this.stack.splice(this.index,this.stack.length-this.index),this.stack.push(e),Q(t)||t&&t===!0?this.redo():this.index++,this.stack.length>this.capacity&&(this.stack.splice(0,this.stack.length-this.capacity),this.index=this.capacity)},clear:function(){this.stack=[],this.index=0}}),b=U.extend({init:function(e){this.toolService=e},start:function(){},move:function(){},end:function(){},doubleClick:function(){},tryActivate:function(){return!1},getCursor:function(){return tt.arrow}}),k=b.extend({init:function(e){b.fn.init.call(this,e)},tryActivate:function(e,n){return this.toolService.hoveredItem===t&&n.ctrlKey},start:function(e){this.toolService.isPanning=!0,this.panStart=this.toolService.diagram._pan,this.panOffset=e,this.panDelta=new K},move:function(e){var t=this.toolService.diagram;this.panDelta=e.plus(this.panDelta).minus(this.panOffset),t.pan(this.panStart.plus(this.panDelta),{delta:e.minus(this.panOffset).times(1/this.toolService.diagram.zoom())})},end:function(){var e=this.toolService.diagram;e.undoRedoService.begin(),e.undoRedoService.add(new m(this.panStart,e._pan,e)),e.undoRedoService.commit(),this.toolService.isPanning=!1},getCursor:function(){return tt.move}}),x=b.extend({init:function(t){var n,i,o,r,a=this;b.fn.init.call(a,t),n=a.toolService.diagram,i=n.canvas,o=n.scroller=a.scroller=e(n.scrollable).kendoMobileScroller({scroll:e.proxy(a._move,a)}).data("kendoMobileScroller"),a.movableCanvas=new et(i.element),r=function(e,t,n){e.makeVirtual(),e.virtualSize(t||pt,n||ft)},r(o.dimensions.x),r(o.dimensions.y),o.disable()},tryActivate:function(e,n){return this.toolService.hoveredItem===t&&n.ctrlKey},start:function(){var e=this.toolService.diagram,t=e.canvas,n=t.size();this.scroller.enable(),this.currentCanvasSize=n
},move:function(){},_move:function(e){var t=this,n=t.toolService.diagram,i=n.canvas,o=t.currentCanvasSize||i.size(),r=new K(e.scrollLeft,e.scrollTop),a=new q(r.x,r.y,parseInt(o.width,10),parseInt(o.height,10));n._storePan(r.times(-1)),t.movableCanvas.moveTo(r),i.viewBox(a)},end:function(){this.currentCanvasSize=t,this.scroller.disable()},getCursor:function(){return tt.move}}),C=U.extend({init:function(e){this.toolService=e},tryActivate:function(){return!0},start:function(e,t){var i=this.toolService.diagram,o=this.toolService.hoveredItem;o&&(n(o,t),o.adorner&&(this.adorner=o.adorner,this.handle=this.adorner._hitTest(e))),this.handle||(this.handle=i._resizingAdorner._hitTest(e),this.handle&&(this.adorner=i._resizingAdorner)),this.adorner&&this.adorner.start(e)},move:function(e){var t=this;this.adorner&&this.adorner.move(t.handle,e)},end:function(e,n){var i,o=this.toolService.diagram,r=this.toolService;this.adorner&&(i=this.adorner.stop(),i&&o.undoRedoService.add(i,!1)),r.hoveredItem&&this.toolService.triggerClick({item:r.hoveredItem,point:e,meta:n}),this.adorner=t,this.handle=t},getCursor:function(e){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(e):tt.arrow}}),T=U.extend({init:function(e){this.toolService=e},tryActivate:function(){return this.toolService.diagram._canRectSelect()&&this.toolService.hoveredItem===t&&this.toolService.hoveredAdorner===t},start:function(e){var t=this.toolService.diagram;t.select(!1),t.selector.start(e)},move:function(e){var t=this.toolService.diagram;t.selector.move(e)},end:function(e,t){var n=this.toolService.diagram,i=this.toolService.hoveredItem,o=n.selector.bounds();i&&i.isSelected||t.ctrlKey||n.select(!1),o.isEmpty()||n.select(o),n.selector.end()},getCursor:function(){return tt.arrow}}),S=U.extend({init:function(e){this.toolService=e,this.type="ConnectionTool"},tryActivate:function(e,t){return this.toolService._hoveredConnector&&!t.ctrlKey},start:function(e,t){var i=this.toolService.diagram,o=this.toolService._hoveredConnector,r=i.connect(o._c,e);this.toolService._connectionManipulation(r,o._c.shape,!0),this.toolService._removeHover(),n(this.toolService.activeConnection,t)},move:function(e){return this.toolService.activeConnection.target(e),!0},end:function(){var e=this.toolService.activeConnection,t=this.toolService.hoveredItem,n=this.toolService._hoveredConnector;n&&n._c!=e.sourceConnector?e.target(n._c):t&&e.target(t),this.toolService._connectionManipulation()},getCursor:function(){return tt.arrow}}),D=U.extend({init:function(e){this.toolService=e,this.type="ConnectionTool"},tryActivate:function(){var e=this.toolService.hoveredItem,t=e&&e.path;return t&&(this._c=e),t},start:function(e,t){n(this._c,t),this.handle=this._c.adorner._hitTest(e),this._c.adorner.start(e)},move:function(e){return this._c.adorner.move(this.handle,e),!0},end:function(e,t){this.toolService.triggerClick({item:this._c,point:e,meta:t});var n=this._c.adorner.stop(e);this.toolService.diagram.undoRedoService.add(n,!1)},getCursor:function(){return tt.move}}),A=b.extend({init:function(e){b.fn.init.call(this,e)},doubleClick:function(){this.toolService.diagram.editor(this.toolService.hoveredItem)},tryActivate:function(e,t){return t.doubleClick&&this.toolService.hoveredItem}}),E=U.extend({init:function(e){this.diagram=e,this.tools=[new A(this),e.options.useScroller?new x(this):new k(this),new D(this),new S(this),new T(this),new C(this)],this.activeTool=t},start:function(e,t){return t=J({},t),this._updateHoveredItem(e),this._activateTool(e,t),this.activeTool.start(e,t),this._updateCursor(e),this.diagram.focus(),this.startPoint=e,!0},move:function(e,t){t=J({},t);var n=!0;return this.activeTool&&(n=this.activeTool.move(e,t)),n&&this._updateHoveredItem(e),this._updateCursor(e),!0},end:function(e,n){return n=J({},n),this.activeTool&&this.activeTool.end(e,n),this.activeTool=t,this._updateCursor(e),!0},doubleClick:function(e,t){this._activateTool(e,J(t,{doubleClick:!0})),this.activeTool.doubleClick&&this.activeTool.doubleClick(e,t),this._updateCursor(e)},keyDown:function(e,t){var n=this.diagram;if(t=J({ctrlKey:!1,metaKey:!1,altKey:!1},t),!t.ctrlKey&&!t.metaKey||t.altKey){if(46===e||8===e)return n.remove(n.select(),!0),!0;if(27===e)return this._discardNewConnection(),n.select(!1),!0}else{if(i(e,"a"))return n.select("All"),!0;if(i(e,"z"))return n.undo(),!0;if(i(e,"y"))return n.redo(),!0;i(e,"c")?n.copy():i(e,"x")?n.cut():i(e,"v")?n.paste():i(e,"l")?n.layout():i(e,"d")&&(n.copy(),n.paste())}},wheel:function(e,t){var n=this.diagram,i=t.delta,o=n.zoom(),r=n.options.zoomRate,a={location:e,meta:t,zoom:o};return n.trigger(ut,a),0>i?o*=r:o/=r,o=Math.round(10*Math.max(.7,Math.min(2,o)))/10,a.zoom=o,n.zoom(o,a),n.trigger(ht,a),!0},setTool:function(e,t){e.toolService=this,this.tools[t]=e},triggerClick:function(e){this.startPoint.equals(e.point)&&this.diagram.trigger("click",e)},_discardNewConnection:function(){this.newConnection&&(this.diagram.remove(this.newConnection),this.newConnection=t)},_activateTool:function(e,t){var n,i;for(n=0;this.tools.length>n;n++)if(i=this.tools[n],i.tryActivate(e,t)){this.activeTool=i;break}},_updateCursor:function(t){var n=this.activeTool?this.activeTool.getCursor(t):this.hoveredAdorner?this.hoveredAdorner._getCursor(t):this.hoveredItem?this.hoveredItem._getCursor(t):tt.arrow;e(this.diagram.canvas.domElement).css({cursor:n})},_connectionManipulation:function(e,n,i){this.activeConnection=e,this.disabledShape=n,this.newConnection=i?this.activeConnection:t},_updateHoveredItem:function(e){var n=this._hitTest(e);n==this.hoveredItem||this.disabledShape&&n==this.disabledShape||(this.hoveredItem&&this.hoveredItem._hover(!1),n&&n.options.enable?(this.hoveredItem=n,this.hoveredItem._hover(!0)):this.hoveredItem=t)},_removeHover:function(){this.hoveredItem&&(this.hoveredItem._hover(!1),this.hoveredItem=t)},_hitTest:function(e){var n,i,o,r,a=this.diagram;if(this._hoveredConnector&&(this._hoveredConnector._hover(!1),this._hoveredConnector=t),a._connectorsAdorner._visible&&(n=a._connectorsAdorner._hitTest(e)))return n;if(n=this.diagram._resizingAdorner._hitTest(e)){if(this.hoveredAdorner=a._resizingAdorner,0!==n.x&&0!==n.y)return;n=t}else this.hoveredAdorner=t;if(!this.activeTool||"ConnectionTool"!==this.activeTool.type){for(r=[],o=0;a._selectedItems.length>o;o++)i=a._selectedItems[o],i instanceof V.Connection&&r.push(i);n=this._hitTestItems(r,e)}return n||this._hitTestItems(a.shapes,e)||this._hitTestItems(a.connections,e)},_hitTestItems:function(e,t){var n,i,o;for(n=e.length-1;n>=0;n--)if(i=e[n],o=i._hitTest(t))return o}}),P=N.Class.extend({init:function(){}}),I=P.extend({init:function(e){var t=this;P.fn.init.call(t),this.connection=e},hitTest:function(e){var t=this.getBounds().inflate(10);return t.contains(e)?V.Geometry.distanceToPolyline(e,this.connection.allPoints())<nt:!1},getBounds:function(){var e,t=this.connection.allPoints(),n=t[0],i=t[t.length-1],o=Math.max(n.x,i.x),r=Math.min(n.x,i.x),a=Math.min(n.y,i.y),s=Math.max(n.y,i.y);for(e=1;t.length-1>e;++e)o=Math.max(o,t[e].x),r=Math.min(r,t[e].x),a=Math.min(a,t[e].y),s=Math.max(s,t[e].y);return new q(r,a,o-r,s-a)}}),z=I.extend({init:function(e){var t=this;I.fn.init.call(t),this.connection=e},route:function(){}}),M=I.extend({init:function(e){var t=this;I.fn.init.call(t),this.connection=e},route:function(){function e(){if(null!==u){if(u===rt||u===at)return!0;if(u===ot||u===st)return!1}return Math.abs(r.x-a.x)>Math.abs(r.y-a.y)}var t,n,i,o=this.connection,r=this.connection.sourcePoint(),a=this.connection.targetPoint(),s=[r,r,a,a],l=a.x-r.x,d=a.y-r.y,c=s.length,u=null,h=null;if(Y.isDefined(o._resolvedSourceConnector)&&(u=o._resolvedSourceConnector.options.name),Y.isDefined(o._resolvedTargetConnector)&&(h=o._resolvedTargetConnector.options.name),null!==u&&null!==h&&Y.contains(lt,u)&&Y.contains(lt,h))u===ot||u==st?h==ot||h==st?this.connection.points([new K(r.x,r.y+d/2),new K(a.x,r.y+d/2)]):this.connection.points([new K(r.x,r.y+d)]):h==at||h==rt?this.connection.points([new K(r.x+l/2,r.y),new K(r.x+l/2,r.y+d)]):this.connection.points([new K(a.x,r.y)]);else{for(this.connection.cascadeStartHorizontal=e(this.connection),i=1;c-1>i;++i)o.cascadeStartHorizontal?i%2!==0?(t=l/(c/2),n=0):(t=0,n=d/((c-1)/2)):i%2!==0?(t=0,n=d/(c/2)):(t=l/((c-1)/2),n=0),s[i]=new K(s[i-1].x+t,s[i-1].y+n);i--,s[c-2]=o.cascadeStartHorizontal&&i%2!==0||!o.cascadeStartHorizontal&&i%2===0?new K(s[c-1].x,s[c-2].y):new K(s[c-2].x,s[c-1].y),this.connection.points([s[1],s[2]])}}}),F=U.extend({init:function(e,t){var n=this;n.diagram=e,n.options=J({},n.options,t),n.visual=new W,n.diagram._adorners.push(n)},refresh:function(){}}),L=F.extend({init:function(e,t){var n,i,o,r=this;r.connection=e,n=r.connection.diagram,r._ts=n.toolService,F.fn.init.call(r,n,t),i=r.connection.sourcePoint(),o=r.connection.targetPoint(),r.spVisual=new $(J(r.options.handles,{center:i})),r.epVisual=new $(J(r.options.handles,{center:o})),r.visual.append(r.spVisual),r.visual.append(r.epVisual)},options:{handles:{}},_getCursor:function(){return tt.move},start:function(e){switch(this.handle=this._hitTest(e),this.startPoint=e,this._initialSource=this.connection.source(),this._initialTarget=this.connection.target(),this.handle){case-1:this.connection.targetConnector&&this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);break;case 1:this.connection.sourceConnector&&this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape)}},move:function(e,t){switch(e){case-1:this.connection.source(t);break;case 1:this.connection.target(t);break;default:var n=t.minus(this.startPoint);this.startPoint=t,this.connection.sourceConnector||this.connection.source(this.connection.sourcePoint().plus(n)),this.connection.targetConnector||this.connection.target(this.connection.targetPoint().plus(n))}return this.refresh(),!0},stop:function(e){var n,i=this.diagram.toolService,o=i.hoveredItem;if(n=i._hoveredConnector?i._hoveredConnector._c:o&&!o.line?o:e,this.handle!==t)switch(this.handle){case-1:this.connection.source(n);break;case 1:this.connection.target(n)}return this.handle=t,this._ts._connectionManipulation(),new c(this.connection,this._initialSource,this._initialTarget)},_hitTest:function(e){var t=this.connection.sourcePoint(),n=this.connection.targetPoint(),i=this.options.handles.width/2,o=this.options.handles.height/2,r=new q(t.x,t.y).inflate(i,o),a=new q(n.x,n.y).inflate(i,o);return r.contains(e)?-1:a.contains(e)?1:0},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())}),this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())})}}),B=F.extend({init:function(e,t){var n=this;F.fn.init.call(n,e,t),n._refreshHandler=function(e){e.item==n.shape&&n.refresh()}},show:function(e){var t,n,i,o=this;for(o._visible=!0,o.shape=e,o.diagram.bind(ct,o._refreshHandler),t=e.connectors.length,o.connectors=[],o.visual.clear(),n=0;t>n;n++)i=new O(e.connectors[n]),o.connectors.push(i),o.visual.append(i.visual);o.visual.visible(!0),o.refresh()},destroy:function(){var e=this;e.diagram.unbind(ct,e._refreshHandler),e.shape=t,e._visible=t,e.visual.visible(!1)},_hitTest:function(e){var t,n;for(n=0;this.connectors.length>n;n++)if(t=this.connectors[n],t._hitTest(e)){t._hover(!0),this.diagram.toolService._hoveredConnector=t;break}},refresh:function(){if(this.shape){var t=this.shape.bounds();t=this.diagram.modelToLayer(t),this.visual.position(t.topLeft()),e.each(this.connectors,function(){this.refresh()})}}}),R=F.extend({init:function(e,t){var n=this;F.fn.init.call(n,e,t),n._manipulating=!1,n.map=[],n.shapes=[],n.rect=new G(t.editable.select),n.visual.append(n.rect),n._createHandles(),n.text=new j,n.visual.append(n.text),n._createThumb(),n.redraw(),n.diagram.bind("select",function(e){n._initialize(e.selected)}),n._refreshHandler=function(){n._internalChange||(n.refreshBounds(),n.refresh())},n._rotatedHandler=function(){1==n.shapes.length&&(n._angle=n.shapes[0].rotate().angle),n._refreshHandler()},n.diagram.bind(ct,n._refreshHandler).bind(dt,n._rotatedHandler),n.refreshBounds(),n.refresh()},options:{editable:{rotate:{thumb:{data:"M7.115,16C3.186,16,0,12.814,0,8.885C0,5.3,2.65,2.336,6.099,1.843V0l4.85,2.801l-4.85,2.8V3.758 c-2.399,0.473-4.21,2.588-4.21,5.126c0,2.886,2.34,5.226,5.226,5.226s5.226-2.34,5.226-5.226c0-1.351-0.513-2.582-1.354-3.51 l1.664-0.961c0.988,1.222,1.581,2.777,1.581,4.472C14.23,12.814,11.045,16,7.115,16L7.115,16z",y:-30}}},offset:10},_createThumb:function(){var e=this,t=e.options.editable,n=t.rotate;t&&n&&(e.rotationThumb=new X(n.thumb),e.visual.append(e.rotationThumb))},_createHandles:function(){var t,n,i,o,r=this.options.editable;if(r&&r.resize)for(t=r.resize.handles,o=-1;1>=o;o++)for(i=-1;1>=i;i++)(0!==o||0!==i)&&(n=new G(t),n.domElement._hover=e.proxy(this._hover,this),this.map.push({x:o,y:i,visual:n}),this.visual.append(n))},bounds:function(e){return e?(this._innerBounds=e.clone(),this._bounds=this.diagram.modelToLayer(e).inflate(this.options.offset,this.options.offset),t):this._bounds},_hitTest:function(e){var n,i,o,r,a=this.diagram.modelToLayer(e),s=this.options.editable,l=this.map.length;if(this._angle&&(a=a.clone().rotate(this._bounds.center(),this._angle)),s&&s.rotate&&this._rotationThumbBounds&&this._rotationThumbBounds.contains(a))return new K(-1,-2);if(s&&s.resize)for(n=0;l>n;n++)if(r=this.map[n],i=new K(r.x,r.y),o=this._getHandleBounds(i),o.offset(this._bounds.x,this._bounds.y),o.contains(a))return i;return this._bounds.contains(a)?new K(0,0):t},_getHandleBounds:function(e){var n,i,o,r,a=this.options.editable;return a&&a.resize?(n=a.resize.handles||{},i=n.width,o=n.height,r=new q(0,0,i,o),0>e.x?r.x=-i/2:0===e.x?r.x=Math.floor(this._bounds.width/2)-i/2:e.x>0&&(r.x=this._bounds.width+1-i/2),0>e.y?r.y=-o/2:0===e.y?r.y=Math.floor(this._bounds.height/2)-o/2:e.y>0&&(r.y=this._bounds.height+1-o/2),r):t},_getCursor:function(e){var t,n=this._hitTest(e);if(n&&n.x>=-1&&1>=n.x&&n.y>=-1&&1>=n.y&&this.options.editable&&this.options.editable.resize){if(t=this._angle,t&&(t=360-t,n.rotate(new K(0,0),t),n=new K(Math.round(n.x),Math.round(n.y))),-1==n.x&&-1==n.y)return"nw-resize";if(1==n.x&&1==n.y)return"se-resize";if(-1==n.x&&1==n.y)return"sw-resize";if(1==n.x&&-1==n.y)return"ne-resize";if(0===n.x&&-1==n.y)return"n-resize";if(0===n.x&&1==n.y)return"s-resize";if(1==n.x&&0===n.y)return"e-resize";if(-1==n.x&&0===n.y)return"w-resize"}return this._manipulating?tt.move:tt.select},_initialize:function(){var e,t,n=this,i=n.diagram.select();for(n.shapes=[],e=0;i.length>e;e++)t=i[e],t instanceof V.Shape&&(n.shapes.push(t),t._rotationOffset=new K);n._angle=1==n.shapes.length?n.shapes[0].rotate().angle:0,n._startAngle=n._angle,n._rotates(),n._positions(),n.refreshBounds(),n.refresh(),n.redraw()},_rotates:function(){var e,t,n=this;for(n.initialRotates=[],e=0;n.shapes.length>e;e++)t=n.shapes[e],n.initialRotates.push(t.rotate().angle)},_positions:function(){var e,t,n=this;for(n.initialStates=[],e=0;n.shapes.length>e;e++)t=n.shapes[e],n.initialStates.push(t.bounds())},_hover:function(e,t){var n,i,o,r,a=this.options.editable;a&&a.resize&&(n=a.resize.handles,i=n.hover,o=n.stroke,r=n.background,e&&Y.isDefined(i.stroke)&&(o=J({},o,i.stroke)),e&&Y.isDefined(i.background)&&(r=i.background),t.redraw({stroke:o,background:r}))},start:function(e){var t,n;for(this._sp=e,this._cp=e,this._lp=e,this._manipulating=!0,this._internalChange=!0,this.shapeStates=[],t=0;this.shapes.length>t;t++)n=this.shapes[t],this.shapeStates.push(n.bounds())},redraw:function(){var t,n,i=this,o=i.options.editable,r=o.resize,a=o.rotate,s=o&&r?"inline":"none",l=o&&a?"inline":"none";for(t=0;this.map.length>t;t++)n=this.map[t],e(n.visual.domElement).css("display",s);i.rotationThumb&&e(i.rotationThumb.domElement).css("display",l)},move:function(e,n){var i,r,a,s,l,d,c,u,h,p,f,g,m,v,_=new K,y=new K,w=0;if(-2===e.y&&-1===e.x){for(s=this._innerBounds.center(),this._angle=this._truncateAngle(Y.findAngle(s,n)),d=0;this.shapes.length>d;d++)l=this.shapes[d],c=(this._angle+this.initialRotates[d]-this._startAngle)%360,l.rotate(c,s),l.hasOwnProperty("layout")&&l.layout(l),this._rotating=!0;this.refresh()}else{if(this.diagram.options.snap.enabled===!0){if(g=this._truncateDistance(n.minus(this._lp)),0===g.x&&0===g.y)return this._cp=n,t;i=g,this._lp=new K(this._lp.x+g.x,this._lp.y+g.y)}else i=n.minus(this._cp);for(0===e.x&&0===e.y?(y=_=i,r=!0):(this._angle&&i.rotate(new K(0,0),this._angle),-1==e.x?_.x=i.x:1==e.x&&(y.x=i.x),-1==e.y?_.y=i.y:1==e.y&&(y.y=i.y)),r||(h=o(e,this._innerBounds),p=(this._innerBounds.width+i.x*e.x)/this._innerBounds.width,f=(this._innerBounds.height+i.y*e.y)/this._innerBounds.height),d=0;this.shapes.length>d;d++)l=this.shapes[d],a=l.bounds(),r?u=this._displaceBounds(a,_,y,r):(u=a.clone(),u.scale(p,f,h,this._innerBounds.center(),l.rotate().angle),m=u.center(),m.rotate(a.center(),-this._angle),u=new q(m.x-u.width/2,m.y-u.height/2,u.width,u.height)),u.width>=l.options.minWidth&&u.height>=l.options.minHeight&&(v=a,l.bounds(u),l.hasOwnProperty("layout")&&l.layout(l,v,u),l.rotate(l.rotate().angle),w+=1);w==d&&(u=this._displaceBounds(this._innerBounds,_,y,r),this.bounds(u),this.refresh()),this._positions()}this._cp=n},_truncatePositionToGuides:function(e){return this.diagram.ruler?this.diagram.ruler.truncatePositionToGuides(e):e},_truncateSizeToGuides:function(e){return this.diagram.ruler?this.diagram.ruler.truncateSizeToGuides(e):e},_truncateAngle:function(e){var t=Math.max(this.diagram.options.snap.angle,5);return this.diagram.options.snap.enabled===!0?Math.floor(e%360/t)*t:e%360},_truncateDistance:function(e){if(e instanceof V.Point)return new V.Point(this._truncateDistance(e.x),this._truncateDistance(e.y));var t=Math.max(this.diagram.options.snap.size,5);return this.diagram.options.snap.enabled===!0?Math.floor(e/t)*t:e},_displaceBounds:function(e,t,n,i){var o,r=e.topLeft().plus(t),a=e.bottomRight().plus(n),s=q.fromPoints(r,a);return i||(o=s.center(),o.rotate(e.center(),-this._angle),s=new q(o.x-s.width/2,o.y-s.height/2,s.width,s.height)),s},stop:function(){var e,n,i,o;if(this._cp!=this._sp)if(this._rotating)e=new v(this,this.shapes,this.initialRotates),this._rotating=!1;else{if(this.diagram.ruler)for(n=0;this.shapes.length>n;n++)i=this.shapes[n],o=i.bounds(),o=this._truncateSizeToGuides(this._truncatePositionToGuides(o)),i.bounds(o),this.refreshBounds(),this.refresh();e=new p(this.shapes,this.shapeStates,this)}return this._manipulating=t,this._internalChange=t,this._rotating=t,e},refreshBounds:function(){var e=1==this.shapes.length?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,!0);this.bounds(e)},refresh:function(){var t,n,i,o,r=this;this.shapes.length>0?(n=this.bounds(),this.visual.visible(!0),this.visual.position(n.topLeft()),e.each(this.map,function(){t=r._getHandleBounds(new K(this.x,this.y)),this.visual.position(t.topLeft())}),this.visual.position(n.topLeft()),i=new K(n.width/2,n.height/2),this.visual.rotate(this._angle,i),this.rect.redraw({width:n.width,height:n.height}),this.rotationThumb&&(o=this.options.editable.rotate.thumb,this._rotationThumbBounds=new q(n.center().x,n.y+o.y,0,0).inflate(o.width),this.rotationThumb.redraw({x:n.width/2-o.width/2}))):this.visual.visible(!1)}}),H=U.extend({init:function(e){this.visual=new G(this.options),this.diagram=e},options:{stroke:{color:"#778899",width:1,dashType:"dash"},background:"none"},start:function(e){this._sp=this._ep=e,this.refresh(),this.diagram._adorn(this,!0)},end:function(){this._sp=this._ep=t,this.diagram._adorn(this,!1)},bounds:function(e){return e&&(this._bounds=e),this._bounds},move:function(e){this._ep=e,this.refresh()},refresh:function(){if(this._sp){var e=q.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));this.bounds(q.fromPoints(this._sp,this._ep)),this.visual.position(e.topLeft()),this.visual.redraw({height:e.height+1,width:e.width+1})}}}),O=U.extend({init:function(e){this.options=J({},e.options),this._c=e,this.visual=new $(this.options),this.refresh()},_hover:function(e){var t=this.options,n=t.hover,i=t.stroke,o=t.background;e&&Y.isDefined(n.stroke)&&(i=J({},i,n.stroke)),e&&Y.isDefined(n.background)&&(o=n.background),this.visual.redraw({stroke:i,background:o})},refresh:function(){var e=this._c.shape.diagram.modelToView(this._c.position()),t=e.minus(this._c.shape.bounds("transformed").topLeft()),n=new q(e.x,e.y,0,0);n.inflate(this.options.width/2,this.options.height/2),this._visualBounds=n,this.visual.redraw({center:new K(t.x,t.y)})},_hitTest:function(e){var t=this._c.shape.diagram.modelToView(e);return this._visualBounds.contains(t)}}),J(V,{CompositeUnit:s,TransformUnit:p,PanUndoUnit:m,AddShapeUnit:g,AddConnectionUnit:f,DeleteShapeUnit:h,DeleteConnectionUnit:u,ContentChangedUndoUnit:l,ConnectionEditAdorner:L,UndoRedoService:w,ResizingAdorner:R,Selector:H,ToolService:E,ConnectorsAdorner:B,LayoutUndoUnit:a,ConnectionEditUnit:d,ToFrontUnit:_,ToBackUnit:y,ConnectionRouterBase:P,PolylineRouter:z,CascadingRouter:M,SelectionTool:T})}(window.kendo.jQuery),function(e){var t=window.kendo,n=t.dataviz.diagram,i=n.Graph,o=n.Node,r=n.Link,a=t.deepExtend,s=n.Size,l=n.Rect,d=n.Dictionary,c=n.Set,u=n.Graph,h=n.Utils,p=n.Point,f=1e-6,g=Math.PI/180,m=h.contains,v=e.grep,_=t.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:!1,limitToView:!1,friction:.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:!1,ignoreContainers:!0,layoutContainerChildren:!1,ignoreInvisible:!0,animateTransitions:!1},init:function(){},gridLayoutComponents:function(e){var t,n,i,o,r,a,s,l,d,c,u,f,g,m,v;if(!e)throw"No components supplied.";for(h.forEach(e,function(e){e.calcBounds()}),e.sort(function(e,t){return t.bounds.width-e.bounds.width}),t=this.options.grid.width,n=this.options.grid.componentSpacingX,i=this.options.grid.componentSpacingY,o=0,r=this.options.grid.offsetX,a=this.options.grid.offsetY,s=r,l=a,c=[],u=[];e.length>0;){for(s>=t&&(s=r,l+=o+i,o=0),f=e.pop(),this.moveToOffset(f,new p(s,l)),d=0;f.nodes.length>d;d++)u.push(f.nodes[d]);for(d=0;f.links.length>d;d++)c.push(f.links[d]);g=f.bounds,m=g.height,(0>=m||isNaN(m))&&(m=0),v=g.width,(0>=v||isNaN(v))&&(v=0),m>=o&&(o=m),s+=v+n}return{nodes:u,links:c}},moveToOffset:function(e,t){var n,i,o,r,a,s,d,c,u=e.bounds,h=t.x-u.x,f=t.y-u.y;for(n=0;e.nodes.length>n;n++)o=e.nodes[n],r=o.bounds(),0===r.width&&0===r.height&&0===r.x&&0===r.y&&(r=new l(0,0,0,0)),r.x+=h,r.y+=f,o.bounds(r);for(n=0;e.links.length>n;n++)if(a=e.links[n],a.points){for(s=[],d=a.points,i=0;d.length>i;i++)c=d[i],c.x+=h,c.y+=f,s.push(c);a.points=s}return this.currentHorizontalOffset+=u.width+this.options.grid.offsetX,new p(h,f)},transferOptions:function(e){this.options=t.deepExtend({},this.defaultOptions),h.isUndefined(e)||(this.options=t.deepExtend(this.options,e||{}))}}),y=t.Class.extend({init:function(e){this.nodeMap=new d,this.shapeMap=new d,this.nodes=[],this.edges=[],this.edgeMap=new d,this.finalNodes=[],this.finalLinks=[],this.ignoredConnections=[],this.ignoredShapes=[],this.hyperMap=new d,this.hyperTree=new i,this.finalGraph=null,this.diagram=e},convert:function(e){if(h.isUndefined(this.diagram))throw"No diagram to convert.";return this.options=t.deepExtend({ignoreInvisible:!0,ignoreContainers:!0,layoutContainerChildren:!1},e||{}),this.clear(),this._renormalizeShapes(),this._renormalizeConnections(),this.finalNodes=new d(this.nodes),this.finalLinks=new d(this.edges),this.finalGraph=new i,this.finalNodes.forEach(function(e){this.finalGraph.addNode(e)},this),this.finalLinks.forEach(function(e){this.finalGraph.addExistingLink(e)},this),this.finalGraph},mapConnection:function(e){return this.edgeMap.first(function(t){return m(this.edgeMap.get(t),e)})},mapShape:function(e){var t,n,i,o=this.nodeMap.keys();for(t=0,n=o.length;n>t;t++)if(i=o[t],m(this.nodeMap.get(i),e))return i},getEdge:function(e,t){return h.first(e.links,function(n){return n.getComplement(e)===t})},clear:function(){this.finalGraph=null,this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new u:null,this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new d:null,this.nodeMap=new d,this.shapeMap=new d,this.nodes=[],this.edges=[],this.edgeMap=new d,this.ignoredConnections=[],this.ignoredShapes=[],this.finalNodes=[],this.finalLinks=[]},listToRoot:function(e){var t=[],n=e.container;if(!n)return t;for(t.push(n);n.parentContainer;)n=n.parentContainer,t.push(n);return t.reverse(),t},firstNonIgnorableContainer:function(e){return e.isContainer&&!this._isIgnorableItem(e)?e:e.parentContainer?this.firstNonIgnorableContainer(e.parentContainer):null},isContainerConnection:function(e,t){return e.isContainer&&this.isDescendantOf(e,t)?!0:t.isContainer&&this.isDescendantOf(t,e)},isDescendantOf:function(e,t){var n,i,o,r;if(!e.isContainer)throw"Expecting a container.";if(e===t)return!1;if(m(e.children,t))return!0;for(n=[],i=0,o=e.children.length;o>i;i++)r=e.children[i],r.isContainer&&this.isDescendantOf(r,t)&&n.push(r);return n.length>0},isIgnorableItem:function(e){return this.options.ignoreInvisible?e.isCollapsed&&this._isVisible(e)?!1:!e.isCollapsed&&this._isVisible(e)?!1:!0:e.isCollapsed&&!this._isTop(e)},isShapeMapped:function(e){return e.isCollapsed&&!this._isVisible(e)&&!this._isTop(e)},leastCommonAncestor:function(e,t){var n,i,o,r,a,s;if(!e)throw"Parameter should not be null.";if(!t)throw"Parameter should not be null.";if(!this.hyperTree)throw"No hypertree available.";if(n=this.listToRoot(e),i=this.listToRoot(t),o=null,h.isEmpty(n)||h.isEmpty(i))return this.hyperTree.root.data;for(r=n[0],a=i[0],s=0;r===a&&(o=n[s],s++,!(s>=n.length||s>=i.length));)r=n[s],a=i[s];return o?v(this.hyperTree.nodes,function(e){return e.data.container===o}):this.hyperTree.root.data},_isTop:function(e){return!e.parentContainer},_isVisible:function(e){return e.visible()?e.parentContainer?this._isVisible(e.parentContainer):e.visible():!1},_isCollapsed:function(e){return e.isContainer&&e.isCollapsed?!0:e.parentContainer&&this._isCollapsed(e.parentContainer)},_renormalizeShapes:function(){var e,t,n,i;if(!this.options.ignoreContainers)throw"Containers are not supported yet, but stay tuned.";for(e=0,t=this.diagram.shapes.length;t>e;e++)n=this.diagram.shapes[e],this.options.ignoreInvisible&&!this._isVisible(n)||n.isContainer?this.ignoredShapes.push(n):(i=new o(n.id,n),i.isVirtual=!1,this.nodeMap.add(i,[n]),this.nodes.push(i))},_renormalizeConnections:function(){var e,t,n,i,o,a,s,l;if(0!==this.diagram.connections.length)for(e=0,t=this.diagram.connections.length;t>e;e++)if(n=this.diagram.connections[e],this.isIgnorableItem(n))this.ignoredConnections.push(n);else if(i=n.sourceConnector?n.sourceConnector.shape:null,o=n.targetConnector?n.targetConnector.shape:null,i&&o)if(!m(this.ignoredShapes,i)||this.shapeMap.containsKey(i))if(!m(this.ignoredShapes,o)||this.shapeMap.containsKey(o))if(this.shapeMap.containsKey(i)&&(i=this.shapeMap[i]),this.shapeMap.containsKey(o)&&(o=this.shapeMap[o]),a=this.mapShape(i),s=this.mapShape(o),a===s||this.areConnectedAlready(a,s))this.ignoredConnections.push(n);else{if(null===a||null===s)throw"A shape was not mapped to a node.";if(!this.options.ignoreContainers)throw"Containers are not supported yet, but stay tuned.";a.isVirtual||s.isVirtual?this.ignoredConnections.push(n):(l=new r(a,s,n.id,n),this.edgeMap.add(l,[n]),this.edges.push(l))}else this.ignoredConnections.push(n);else this.ignoredConnections.push(n);else this.ignoredConnections.push(n)},areConnectedAlready:function(e,t){return h.any(this.edges,function(n){return n.source===e&&n.target===t||n.source===t&&n.target===e})}}),w=_.extend({init:function(e){var t=this;if(_.fn.init.call(t),h.isUndefined(e))throw"Diagram is not specified.";this.diagram=e},layout:function(e){var t,i,o,r,a,s;if(this.transferOptions(e),t=new y(this.diagram),i=t.convert(e),!i.isEmpty()&&(o=i.getConnectedComponents(),!h.isEmpty(o))){for(r=0;o.length>r;r++)a=o[r],this.layoutGraph(a,e);return s=this.gridLayoutComponents(o),new n.LayoutState(this.diagram,s)}},layoutGraph:function(e,t){var n,i,o;for(h.isDefined(t)&&this.transferOptions(t),this.graph=e,n=9*this.options.nodeDistance,this.temperature=n,i=this._expectedBounds(),this.width=i.width,this.height=i.height,o=0;this.options.iterations>o;o++)this.refineStage=o>=5*this.options.iterations/6,this.tick(),this.temperature=this.refineStage?n/30:n*(1-o/(2*this.options.iterations))},tick:function(){var e,t,n;for(e=0;this.graph.nodes.length>e;e++)this._repulsion(this.graph.nodes[e]);for(e=0;this.graph.links.length>e;e++)this._attraction(this.graph.links[e]);for(e=0;this.graph.nodes.length>e;e++){if(t=this.graph.nodes[e],n=Math.sqrt(t.dx*t.dx+t.dy*t.dy),0===n)return;t.x+=Math.min(n,this.temperature)*t.dx/n,t.y+=Math.min(n,this.temperature)*t.dy/n,this.options.limitToView&&(t.x=Math.min(this.width,Math.max(t.width/2,t.x)),t.y=Math.min(this.height,Math.max(t.height/2,t.y)))}},_shake:function(e){var t=Math.random()*this.options.nodeDistance/4,n=2*Math.random()*Math.PI;e.x+=t*Math.cos(n),e.y-=t*Math.sin(n)},_InverseSquareForce:function(e,t,n){var i,o,r,a,s,l,d;return this.refineStage?(o=t.x-n.x,r=t.y-n.y,a=t.width/2,s=t.height/2,l=n.width/2,d=n.height/2,i=Math.pow(o,2)/Math.pow(a+l+this.options.nodeDistance,2)+Math.pow(r,2)/Math.pow(s+d+this.options.nodeDistance,2)):i=Math.pow(e,2)/Math.pow(this.options.nodeDistance,2),4*i/3},_SquareForce:function(e,t,n){return 1/this._InverseSquareForce(e,t,n)},_repulsion:function(e){e.dx=0,e.dy=0,h.forEach(this.graph.nodes,function(t){var n,i,o,r;if(t!==e){for(;e.x===t.x&&e.y===t.y;)this._shake(t);n=e.x-t.x,i=e.y-t.y,o=Math.sqrt(n*n+i*i),r=2*this._SquareForce(o,e,t),e.dx+=n/o*r,e.dy+=i/o*r}},this)},_attraction:function(e){var t,n,i,o,r,a,s=e.target,l=e.source;if(l!==s){for(;l.x===s.x&&l.y===s.y;)this._shake(s);t=l.x-s.x,n=l.y-s.y,i=Math.sqrt(t*t+n*n),o=5*this._InverseSquareForce(i,l,s),r=t/i*o,a=n/i*o,s.dx+=r,s.dy+=a,l.dx-=r,l.dy-=a}},_expectedBounds:function(){var e,t,n,i,o,r=this.graph.nodes.length,a=1.5,s=4;return 0===r?e:(e=h.fold(this.graph.nodes,function(e,t){var n=t.width*t.height;return n>0?e+=Math.sqrt(n):0},0,this),t=e/r,n=t*Math.ceil(Math.sqrt(r)),i=n*Math.sqrt(a),o=n/Math.sqrt(a),{width:i*s,height:o*s})}}),b=t.Class.extend({init:function(e){this.center=null,this.options=e},layout:function(e,t){if(this.graph=e,this.graph.nodes&&0!==this.graph.nodes.length){if(!m(this.graph.nodes,t))throw"The given root is not in the graph.";this.center=t,this.graph.cacheRelationships(),this.layoutSwitch()}},layoutLeft:function(e){var t,n,i,o,r,a,l,d;for(this.setChildrenDirection(this.center,"Left",!1),this.setChildrenLayout(this.center,"Default",!1),t=0,n=0,o=0;e.length>o;o++)r=e[o],r.TreeDirection="Left",a=this.measure(r,s.Empty),n=Math.max(n,a.Width),t+=a.height+this.options.verticalSeparation;for(t-=this.options.verticalSeparation,l=this.center.x-this.options.horizontalSeparation,i=this.center.y+(this.center.height-t)/2,o=0;e.length>o;o++)r=e[o],d=new p(l-r.Size.width,i),this.arrange(r,d),i+=r.Size.height+this.options.verticalSeparation},layoutRight:function(e){var t,n,i,o,r,a,l,d;for(this.setChildrenDirection(this.center,"Right",!1),this.setChildrenLayout(this.center,"Default",!1),t=0,n=0,o=0;e.length>o;o++)r=e[o],r.TreeDirection="Right",a=this.measure(r,s.Empty),n=Math.max(n,a.Width),t+=a.height+this.options.verticalSeparation;for(t-=this.options.verticalSeparation,l=this.center.x+this.options.horizontalSeparation+this.center.width,i=this.center.y+(this.center.height-t)/2,o=0;e.length>o;o++)r=e[o],d=new p(l,i),this.arrange(r,d),i+=r.Size.height+this.options.verticalSeparation},layoutUp:function(e){var t,n,i,o,r,a,l;for(this.setChildrenDirection(this.center,"Up",!1),this.setChildrenLayout(this.center,"Default",!1),t=0,o=0;e.length>o;o++)i=e[o],i.TreeDirection="Up",r=this.measure(i,s.Empty),t+=r.width+this.options.horizontalSeparation;
for(t-=this.options.horizontalSeparation,a=this.center.x+this.center.width/2-t/2,o=0;e.length>o;o++)i=e[o],n=this.center.y-this.options.verticalSeparation-i.Size.height,l=new p(a,n),this.arrange(i,l),a+=i.Size.width+this.options.horizontalSeparation},layoutDown:function(e){var t,n,i,o,r,a,l;for(this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),i=0,n=0;e.length>n;n++)t=e[n],t.treeDirection="Down",r=this.measure(t,s.Empty),i+=r.width+this.options.horizontalSeparation;for(i-=this.options.horizontalSeparation,a=this.center.x+this.center.width/2-i/2,o=this.center.y+this.options.verticalSeparation+this.center.height,n=0;e.length>n;n++)t=e[n],l=new p(a,o),this.arrange(t,l),a+=t.Size.width+this.options.horizontalSeparation},layoutRadialTree:function(){var e,t;if(this.setChildrenDirection(this.center,"Radial",!1),this.setChildrenLayout(this.center,"Default",!1),this.previousRoot=null,e=this.options.startRadialAngle*g,t=this.options.endRadialAngle*g,e>=t)throw"Final angle should not be less than the start angle.";this.maxDepth=0,this.origin=new p(this.center.x,this.center.y),this.calculateAngularWidth(this.center,0),this.maxDepth>0&&this.radialLayout(this.center,this.options.radialFirstLevelSeparation,e,t),this.center.Angle=t-e},tipOverTree:function(e,t){var n,i,o,r,a,l,d;for(h.isUndefined(t)&&(t=0),this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),this.setChildrenLayout(this.center,"Underneath",!1,t),n=0,r=0;e.length>r;r++)o=e[r],o.TreeDirection="Down",a=this.measure(o,s.Empty),n+=a.width+this.options.horizontalSeparation;for(n-=this.options.horizontalSeparation,n-=e[e.length-1].width,n+=e[e.length-1].associatedShape.bounds().width,l=this.center.x+this.center.width/2-n/2,i=this.center.y+this.options.verticalSeparation+this.center.height,r=0;e.length>r;r++)o=e[r],d=new p(l,i),this.arrange(o,d),l+=o.Size.width+this.options.horizontalSeparation},calculateAngularWidth:function(e,t){var n,i,o,r,a,s,l;if(t>this.maxDepth&&(this.maxDepth=t),n=0,i=1e3,o=1e3,r=0===t?0:Math.sqrt(i*i+o*o)/t,e.children.length>0){for(a=0,s=e.children.length;s>a;a++)l=e.children[a],n+=this.calculateAngularWidth(l,t+1);n=Math.max(r,n)}else n=r;return e.sectorAngle=n,n},sortChildren:function(e){var t,n,i,o,r,a,s,l,d,c,u,f=0;if(e.parents.length>1)throw"Node is not part of a tree.";if(n=e.parents[0],n&&(i=new p(n.x,n.y),o=new p(e.x,e.y),f=this.normalizeAngle(Math.atan2(i.y-o.y,i.x-o.x))),r=e.children.length,0===r)return null;for(a=[],s=[],t=0;r>t;++t)l=e.children[t],d=new p(l.x,l.y),s[t]=t,a[t]=this.normalizeAngle(-f+Math.atan2(d.y-d.y,d.x-d.x));for(h.bisort(a,s),c=[],u=e.children,t=0;r>t;++t)c.push(u[s[t]]);return c},normalizeAngle:function(e){for(;e>2*Math.PI;)e-=2*Math.PI;for(;0>e;)e+=2*Math.PI;return e},radialLayout:function(e,t,n,i){var o,r,a,s,l,d=i-n,c=d/2,u=e.sectorAngle,h=0,p=this.sortChildren(e);for(o=0,r=p.length;r>o;o++)a=p[o],s=a,l=s.sectorAngle/u,a.children.length>0&&this.radialLayout(a,t+this.options.radialSeparation,n+h*d,n+(h+l)*d),this.setPolarLocation(a,t,n+h*d+l*c),s.angle=l*d,h+=l},setPolarLocation:function(e,t,n){e.x=this.origin.x+t*Math.cos(n),e.y=this.origin.y+t*Math.sin(n),e.BoundingRectangle=new l(e.x,e.y,e.width,e.height)},setChildrenDirection:function(e,t,n){var i=e.treeDirection;this.graph.depthFirstTraversal(e,function(e){e.treeDirection=t}),n||(e.treeDirection=i)},setChildrenLayout:function(e,t,n,i){h.isUndefined(i)&&(i=0);var o=e.childrenLayout;i>0?(this.graph.assignLevels(e),this.graph.depthFirstTraversal(e,function(e){e.level>=i+1&&(e.childrenLayout=t)})):(this.graph.depthFirstTraversal(e,function(e){e.childrenLayout=t}),n||(e.childrenLayout=o))},measure:function(e,t){var n,i,o,r,a,l,d,c=0,u=0,p=new s(0,0);if(!e)throw"";if(i=e.associatedShape.bounds(),o=i.width,r=i.height,1!==e.parents.length)throw"Node not in a spanning tree.";if(a=e.parents[0],"Undefined"===e.treeDirection&&(e.treeDirection=a.treeDirection),h.isEmpty(e.children))p=new s(Math.abs(o)<f?50:o,Math.abs(r)<f?25:r);else if(1===e.children.length){switch(e.treeDirection){case"Radial":n=this.measure(e.children[0],t),c=o+this.options.radialSeparation*Math.cos(e.AngleToParent)+n.width,u=r+Math.abs(this.options.radialSeparation*Math.sin(e.AngleToParent))+n.height;break;case"Left":case"Right":switch(e.childrenLayout){case"TopAlignedWithParent":break;case"BottomAlignedWithParent":break;case"Underneath":n=this.measure(e.children[0],t),c=o+n.width+this.options.underneathHorizontalOffset,u=r+this.options.underneathVerticalTopOffset+n.height;break;case"Default":n=this.measure(e.children[0],t),c=o+this.options.horizontalSeparation+n.width,u=Math.max(r,n.height);break;default:throw"Unhandled TreeDirection in the Radial layout measuring."}break;case"Up":case"Down":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":n=this.measure(e.children[0],t),c=Math.max(o,n.width+this.options.underneathHorizontalOffset),u=r+this.options.underneathVerticalTopOffset+n.height;break;case"Default":n=this.measure(e.children[0],t),u=r+this.options.verticalSeparation+n.height,c=Math.max(o,n.width);break;default:throw"Unhandled TreeDirection in the Down layout measuring."}break;default:throw"Unhandled TreeDirection in the layout measuring."}p=new s(c,u)}else{switch(e.treeDirection){case"Left":case"Right":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=o,u=r+this.options.underneathVerticalTopOffset,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c=Math.max(c,n.width+this.options.underneathHorizontalOffset),u+=n.height+this.options.underneathVerticalSeparation;u-=this.options.underneathVerticalSeparation;break;case"Default":for(c=o,u=0,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c=Math.max(c,o+this.options.horizontalSeparation+n.width),u+=n.height+this.options.verticalSeparation;u-=this.options.verticalSeparation;break;default:throw"Unhandled TreeDirection in the Right layout measuring."}break;case"Up":case"Down":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=o,u=r+this.options.underneathVerticalTopOffset,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c=Math.max(c,n.width+this.options.underneathHorizontalOffset),u+=n.height+this.options.underneathVerticalSeparation;u-=this.options.underneathVerticalSeparation;break;case"Default":for(c=0,u=0,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c+=n.width+this.options.horizontalSeparation,u=Math.max(u,n.height+this.options.verticalSeparation+r);c-=this.options.horizontalSeparation;break;default:throw"Unhandled TreeDirection in the Down layout measuring."}break;default:throw"Unhandled TreeDirection in the layout measuring."}p=new s(c,u)}return e.SectorAngle=Math.sqrt(c*c/4+u*u/4),e.Size=p,p},arrange:function(e,t){var n,i,o,r,a,s,d,c,u=e.associatedShape.bounds(),g=u.width,m=u.height;if(h.isEmpty(e.children))e.x=t.x,e.y=t.y,e.BoundingRectangle=new l(t.x,t.y,g,m);else switch(e.treeDirection){case"Left":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=t,e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),d=t.y+m+this.options.underneathVerticalTopOffset,n=0;r.children.length>n;n++)r=r.children[n],s=c.x-r.associatedShape.width-this.options.underneathHorizontalOffset,i=new p(s,d),this.arrange(r,i),d+=r.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(c=new p(t.x+e.Size.width-g,t.y+(e.Size.height-m)/2),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=c.x-this.options.horizontalSeparation,d=t.y,n=0;e.children.length>n;n++)r=e.children[n],i=new p(s-r.Size.width,d),this.arrange(r,i),d+=r.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"Right":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=t,e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=t.x+g+this.options.underneathHorizontalOffset,d=t.y+m+this.options.underneathVerticalTopOffset,n=0;e.children.length>n;n++)r=e.children[n],i=new p(s,d),this.arrange(r,i),d+=r.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(c=new p(t.x,t.y+(e.Size.height-m)/2),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=t.x+g+this.options.horizontalSeparation,d=t.y,n=0;e.children.length>n;n++)r=e.children[n],i=new p(s,d),this.arrange(r,i),d+=r.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"Up":if(c=new p(t.x+(e.Size.width-g)/2,t.y+e.Size.height-m),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),Math.abs(c.x-t.x)<f){for(a=0,n=0;e.children.length>n;n++)o=e.children[n],a+=o.Size.width+this.options.horizontalSeparation;a-=this.options.horizontalSeparation,s=t.x+(g-a)/2}else s=t.x;for(n=0;e.children.length>n;n++)r=e.children[n],d=c.y-this.options.verticalSeparation-r.Size.height,i=new p(s,d),this.arrange(r,i),s+=r.Size.width+this.options.horizontalSeparation;break;case"Down":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=t,e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=t.x+this.options.underneathHorizontalOffset,d=t.y+m+this.options.underneathVerticalTopOffset,n=0;e.children.length>n;n++)r=e.children[n],i=new p(s,d),this.arrange(r,i),d+=r.Size.height+this.options.underneathVerticalSeparation;break;case"Default":if(c=new p(t.x+(e.Size.width-g)/2,t.y),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),Math.abs(c.x-t.x)<f){for(a=0,n=0;e.children.length>n;n++)o=e.children[n],a+=o.Size.width+this.options.horizontalSeparation;a-=this.options.horizontalSeparation,s=t.x+(g-a)/2}else s=t.x;for(n=0;e.children.length>n;n++)r=e.children[n],d=c.y+this.options.verticalSeparation+m,i=new p(s,d),this.arrange(r,i),s+=r.Size.width+this.options.horizontalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"None":break;default:throw"Unsupported TreeDirection"}},layoutSwitch:function(){var e,t,n,i,o,r;if(this.center&&!h.isEmpty(this.center.children))switch(e=this.options.subtype,h.isUndefined(e)&&(e="Down"),r=this.center.children,e.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();break;case"mindmaphorizontal":case"mindmap":t=this.center.children,1===this.center.children.length?this.layoutRight(t):(o=r.length/2,n=v(this.center.children,function(e){return h.indexOf(r,e)<o}),i=v(this.center.children,function(e){return h.indexOf(r,e)>=o}),this.layoutLeft(n),this.layoutRight(i));break;case"mindmapvertical":t=this.center.children,1===this.center.children.length?this.layoutDown(t):(o=r.length/2,n=v(this.center.children,function(e){return h.indexOf(r,e)<o}),i=v(this.center.children,function(e){return h.indexOf(r,e)>=o}),this.layoutUp(n),this.layoutDown(i));break;case"right":this.layoutRight(this.center.children);break;case"left":this.layoutLeft(this.center.children);break;case"up":case"bottom":this.layoutUp(this.center.children);break;case"down":case"top":this.layoutDown(this.center.children);break;case"tipover":case"tipovertree":if(0>this.options.tipOverTreeStartLevel)throw"The tip-over level should be a positive integer.";this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);break;case"undefined":case"none":}}}),k=_.extend({init:function(e){var t=this;if(_.fn.init.call(t),h.isUndefined(e))throw"No diagram specified.";this.diagram=e},layout:function(e){var t,i;return this.transferOptions(e),t=new y(this.diagram),this.graph=t.convert(),i=this.layoutComponents(),new n.LayoutState(this.diagram,i)},layoutComponents:function(){var e,t,n,i,o,r,a,s;if(!this.graph.isEmpty()&&(e=this.graph.getConnectedComponents(),!h.isEmpty(e))){for(t=new b(this.options),n=[],i=0;e.length>i;i++){if(o=e[i],r=this.getTree(o),!r)throw"Failed to find a spanning tree for the component.";a=r.root,s=r.tree,t.layout(s,a),n.push(s)}return this.gridLayoutComponents(n)}},getTree:function(e){var t,n,i,o,r,a=null;if(this.options.roots&&this.options.roots.length>0)for(t=0,n=e.nodes.length;n>t;t++)for(i=e.nodes[t],o=0;this.options.roots.length>o;o++)if(r=this.options.roots[o],r===i.associatedShape){a=i;break}if(!a&&(a=e.root(),!a))throw"Unable to find a root for the tree.";return this.getTreeForRoot(e,a)},getTreeForRoot:function(e,t){var n=e.getSpanningTree(t);return h.isUndefined(n)||n.isEmpty()?null:{tree:n,root:n.root}}}),x=_.extend({init:function(e){var t=this;if(_.fn.init.call(t),h.isUndefined(e))throw"Diagram is not specified.";this.diagram=e},layout:function(e){var t,i,o,r,a,s;if(this.transferOptions(e),t=new y(this.diagram),i=t.convert(e),!i.isEmpty()&&(o=i.getConnectedComponents(),!h.isEmpty(o))){for(r=0;o.length>r;r++)a=o[r],this.layoutGraph(a,e);return s=this.gridLayoutComponents(o),new n.LayoutState(this.diagram,s)}},_initRuntimeProperties:function(){var e,t;for(e=0;this.graph.nodes.length>e;e++)t=this.graph.nodes[e],t.layer=-1,t.downstreamLinkCount=0,t.upstreamLinkCount=0,t.isVirtual=!1,t.uBaryCenter=0,t.dBaryCenter=0,t.upstreamPriority=0,t.downstreamPriority=0,t.gridPosition=0},_prepare:function(e){var t,n,i,o,r,a,s,l,c,u,p,f,g=[];for(n=0;e.links.length>n;n++)e.links[n].depthOfDumminess=0;for(o=new d,h.forEach(e.nodes,function(e){0===e.incoming.length&&(o.set(e,0),g.push(e))});g.length>0;)for(r=g.shift(),t=0;r.outgoing.length>t;t++)i=r.outgoing[t],a=i.target,o.containsKey(a)?o.set(a,Math.max(o.get(r)+1,o.get(a))):o.set(a,o.get(r)+1),m(g,a)||g.push(a);for(s=0,o.forEachValue(function(e){s=Math.max(s,e)}),l=[],h.addRange(l,o.keys()),l.sort(function(e,t){var n=o.get(e),i=o.get(t);return h.sign(i-n)}),c=0;l.length>c;++c)if(u=l[c],p=Number.MAX_VALUE,0!==u.outgoing.length){for(n=0;u.outgoing.length>n;++n)i=u.outgoing[n],p=Math.min(p,o.get(i.target));p>1&&o.set(u,p-1)}for(this.layers=[],t=0;s+1>t;t++)this.layers.push([]);for(o.forEach(function(e,t){e.layer=t,this.layers[t].push(e)},this),n=0;this.layers.length>n;n++)for(f=this.layers[n],t=0;f.length>t;t++)f[t].gridPosition=t},layoutGraph:function(e,t){if(h.isUndefined(e))throw"No graph given or graph analysis of the diagram failed.";h.isDefined(t)&&this.transferOptions(t),this.graph=e,e.setItemIndices();var n=e.makeAcyclic();this._initRuntimeProperties(),this._prepare(e,t),this._dummify(),this._optimizeCrossings(),this._swapPairs(),this.arrangeNodes(),this._moveThingsAround(),this._dedummify(),h.forEach(n,function(e){e.points&&e.points.reverse()})},setMinDist:function(e,t,n){var i=e.layer,o=e.layerIndex;this.minDistances[i][o]=n},getMinDist:function(e,t){var n,i=0,o=e.layerIndex,r=t.layerIndex,a=e.layer,s=Math.min(o,r),l=Math.max(o,r);for(n=s;l>n;++n)i+=this.minDistances[a][n];return i},placeLeftToRight:function(e){var t,n,i,o,r,a,s,l,c,u,p=new d;for(i=0;this.layers.length>i;++i)if(o=e[i]){for(t=0;o.length>t;t++)n=o[t],p.containsKey(n)||this.placeLeft(n,p,i);for(r=Number.POSITIVE_INFINITY,t=0;o.length>t;t++)n=o[t],a=this.rightSibling(n),a&&this.nodeLeftClass.get(a)!==i&&(r=Math.min(r,p.get(a)-p.get(n)-this.getMinDist(n,a)));if(r===Number.POSITIVE_INFINITY){for(s=[],t=0;o.length>t;t++)for(n=o[t],l=[],h.addRange(l,this.upNodes.get(n)),h.addRange(l,this.downNodes.get(n)),c=0;l.length>c;c++)u=l[c],this.nodeLeftClass.get(u)<i&&s.push(p.get(u)-p.get(n));s.sort(),r=0===s.length?0:s.length%2===1?s[this.intDiv(s.length,2)]:(s[this.intDiv(s.length,2)-1]+s[this.intDiv(s.length,2)])/2}for(t=0;o.length>t;t++)n=o[t],p.set(n,p.get(n)+r)}return p},placeRightToLeft:function(e){var t,n,i,o,r,a,s,l,c,u,p=new d;for(i=0;this.layers.length>i;++i)if(o=e[i]){for(t=0;o.length>t;t++)n=o[t],p.containsKey(n)||this.placeRight(n,p,i);for(r=Number.NEGATIVE_INFINITY,t=0;o.length>t;t++)n=o[t],a=this.leftSibling(n),a&&this.nodeRightClass.get(a)!==i&&(r=Math.max(r,p.get(a)-p.get(n)+this.getMinDist(a,n)));if(r===Number.NEGATIVE_INFINITY){for(s=[],t=0;o.length>t;t++)for(n=o[t],l=[],h.addRange(l,this.upNodes.get(n)),h.addRange(l,this.downNodes.get(n)),c=0;l.length>c;c++)u=l[c],this.nodeRightClass.get(u)<i&&s.push(p.get(n)-p.get(u));s.sort(),r=0===s.length?0:s.length%2===1?s[this.intDiv(s.length,2)]:(s[this.intDiv(s.length,2)-1]+s[this.intDiv(s.length,2)])/2}for(t=0;o.length>t;t++)n=o[t],p.set(n,p.get(n)+r)}return p},_getLeftWing:function(){var e={value:null},t=this.computeClasses(e,1);return this.nodeLeftClass=e.value,t},_getRightWing:function(){var e={value:null},t=this.computeClasses(e,-1);return this.nodeRightClass=e.value,t},computeClasses:function(e,t){var n,i,o,r,a,s,l,c,u,h=0,p=e.value=new d;for(n=0;this.layers.length>n;++n)for(h=n,i=this.layers[n],o=1===t?0:i.length-1;o>=0&&i.length>o;o+=t)if(r=i[o],p.containsKey(r))h=p.get(r);else if(p.set(r,h),r.isVirtual)for(a=this._nodesInLink(r),s=0;a.length>s;s++)l=a[s],p.set(l,h);for(c=[],u=0;this.layers.length>u;u++)c.push(null);return p.forEach(function(e,t){null===c[t]&&(c[t]=[]),c[t].push(e)}),c},_isVerticalLayout:function(){return"up"===this.options.subtype.toLowerCase()||"down"===this.options.subtype.toLowerCase()||"vertical"===this.options.subtype.toLowerCase()},_isHorizontalLayout:function(){return"right"===this.options.subtype.toLowerCase()||"left"===this.options.subtype.toLowerCase()||"horizontal"===this.options.subtype.toLowerCase()},_isIncreasingLayout:function(){return"right"===this.options.subtype.toLowerCase()||"down"===this.options.subtype.toLowerCase()},_moveThingsAround:function(){function e(e,t){var n,i,o=Number.MIN_VALUE;for(n=0;e.length>n;++n)i=e[n],o=t._isVerticalLayout()?Math.max(o,i.height):Math.max(o,i.width);return o}var t,n,i,o,r,a,s,l,c,u,p,f,g,m,v,_,y,w,b,k,x,C,T,S,D,A,E;for(n=0;this.layers.length>n;++n)o=this.layers[n],o.sort(this._gridPositionComparer);for(this.minDistances=[],n=0;this.layers.length>n;++n)for(o=this.layers[n],this.minDistances[n]=[],r=0;o.length>r;++r)i=o[r],i.layerIndex=r,this.minDistances[n][r]=this.options.nodeDistance,o.length-1>r&&(this.minDistances[n][r]+=this._isVerticalLayout()?(i.width+o[r+1].width)/2:(i.height+o[r+1].height)/2);for(this.downNodes=new d,this.upNodes=new d,h.forEach(this.graph.nodes,function(e){this.downNodes.set(e,[]),this.upNodes.set(e,[])},this),h.forEach(this.graph.links,function(e){var t=e.source,n=e.target,i=null,o=null;t.layer>n.layer?(i=e.source,o=e.target):(o=e.source,i=e.target),this.downNodes.get(o).push(i),this.upNodes.get(i).push(o)},this),this.downNodes.forEachValue(function(e){e.sort(this._gridPositionComparer)}),this.upNodes.forEachValue(function(e){e.sort(this._gridPositionComparer)}),n=0;this.layers.length-1>n;++n)for(o=this.layers[n],a=0;o.length-1>a;a++)if(s=o[a],s.isVirtual&&(l=this.downNodes.get(s)[0],l.isVirtual))for(r=a+1;o.length>r;++r)i=o[r],i.isVirtual&&(c=this.downNodes.get(i)[0],c.isVirtual&&l.gridPosition>c.gridPosition&&(u=l.gridPosition,l.gridPosition=c.gridPosition,c.gridPosition=u,p=l.layerIndex,f=c.layerIndex,this.layers[n+1][p]=c,this.layers[n+1][f]=l,l.layerIndex=f,c.layerIndex=p));for(g=this._getLeftWing(),m=this._getRightWing(),v=this.placeLeftToRight(g),_=this.placeRightToLeft(m),y=new d,h.forEach(this.graph.nodes,function(e){y.set(e,(v.get(e)+_.get(e))/2)}),w=new d,b=new d,n=0;this.layers.length>n;++n)for(o=this.layers[n],k=-1,x=-1,r=0;o.length>r;++r)i=o[r],w.set(i,0),b.set(i,!1),i.isVirtual&&(-1===k?k=r:k===r-1?k=r:(x=r,w.set(o[k],0),y.get(i)-y.get(o[k])===this.getMinDist(o[k],i)?b.set(o[k],!0):b.set(o[k],!1),k=r));for(C=[1,-1],h.forEach(C,function(e){var n,i,o,r,a,s,l,d=1===e?0:this.layers.length-1;for(n=d;n>=0&&this.layers.length>n;n+=e){if(i=this.layers[n],o=this._firstVirtualNode(i),r=null,a=null,-1!==o)for(r=i[o],a=[],t=0;o>t;t++)a.push(i[t]);else r=null,a=i;if(a.length>0){for(this._sequencer(y,null,r,e,a),t=0;a.length-1>t;++t)this.setMinDist(a[t],a[t+1],y.get(a[t+1])-y.get(a[t]));r&&this.setMinDist(a[a.length-1],r,y.get(r)-y.get(a[a.length-1]))}for(;r;){if(s=this.nextVirtualNode(i,r)){if(w.get(r)===e){for(o=r.layerIndex,l=s.layerIndex,a=[],t=o+1;l>t;t++)a.push(i[t]);a.length>0&&this._sequencer(y,r,s,e,a),b.set(r,!0)}}else{for(o=r.layerIndex,a=[],t=o+1;i.length>t;t++)a.push(i[t]);if(a.length>0){for(this._sequencer(y,r,null,e,a),t=0;a.length-1>t;++t)this.setMinDist(a[t],a[t+1],y.get(a[t+1])-y.get(a[t]));this.setMinDist(r,a[0],y.get(a[0])-y.get(r))}}r=s}this.adjustDirections(n,e,w,b)}},this),T=this._isIncreasingLayout()?0:this.layers.length-1,S=function(e,t){return t._isIncreasingLayout()?t.layers.length>e:e>=0},D=this._isIncreasingLayout()?1:-1,A=0,t=T;S(t,this);t+=D){for(o=this.layers[t],E=e(o,this),r=0;o.length>r;++r)i=o[r],this._isVerticalLayout()?(i.x=y.get(i),i.y=A+E/2):(i.x=A+E/2,i.y=y.get(i));A+=this.options.layerSeparation+E}},adjustDirections:function(e,t,n,i){var o,r,a,s,l,d,c,u,h,p,f,g,m,v;if(!(0>e+t||e+t>=this.layers.length))for(o=null,r=null,a=this.layers[e+t],s=0;a.length>s;++s)if(l=a[s],l.isVirtual&&(d=this.getNeighborOnLayer(l,e),d.isVirtual)){if(o){for(c=i.get(r),u=this.layers[e],h=r.layerIndex,p=d.layerIndex,f=h+1;p>f;++f)u[f].isVirtual&&(c=c&&i.get(u[f]));if(c)for(n.set(o,t),g=o.layerIndex,m=l.layerIndex,v=g+1;m>v;++v)a[v].isVirtual&&n.set(a[v],t)}o=l,r=d}},getNeighborOnLayer:function(e,t){var n=this.upNodes.get(e)[0];return n.layer===t?n:(n=this.downNodes.get(e)[0],n.layer===t?n:null)},_sequencer:function(e,t,n,i,o){if(1===o.length&&this._sequenceSingle(e,t,n,i,o[0]),o.length>1){var r=o.length,a=this.intDiv(r,2);this._sequencer(e,t,n,i,o.slice(0,a)),this._sequencer(e,t,n,i,o.slice(a)),this.combineSequences(e,t,n,i,o)}},_sequenceSingle:function(e,t,n,i,o){var r=-1===i?this.downNodes.get(o):this.upNodes.get(o),a=r.length;0!==a&&(a%2===1?e.set(o,e.get(r[this.intDiv(a,2)])):e.set(o,(e.get(r[this.intDiv(a,2)-1])+e.get(r[this.intDiv(a,2)]))/2),t&&e.set(o,Math.max(e.get(o),e.get(t)+this.getMinDist(t,o))),n&&e.set(o,Math.min(e.get(o),e.get(n)-this.getMinDist(o,n))))},combineSequences:function(e,t,n,i,o){var r,a,s,l,d,c,u,h,p,f,g=o.length,m=this.intDiv(g,2),v=[];for(r=0;m>r;++r){for(a=0,l=-1===i?this.downNodes.get(o[r]):this.upNodes.get(o[r]),s=0;l.length>s;++s)d=l[s],e.get(d)>=e.get(o[r])?a++:(a--,v.push({k:e.get(d)+this.getMinDist(o[r],o[m-1]),v:2}));v.push({k:e.get(o[r])+this.getMinDist(o[r],o[m-1]),v:a})}for(t&&v.push({k:e.get(t)+this.getMinDist(t,o[m-1]),v:Number.MAX_VALUE}),v.sort(this._positionDescendingComparer),u=[],r=m;g>r;++r){for(a=0,l=-1===i?this.downNodes.get(o[r]):this.upNodes.get(o[r]),s=0;l.length>s;++s)d=l[s],e.get(d)<=e.get(o[r])?a++:(a--,u.push({k:e.get(d)-this.getMinDist(o[r],o[m]),v:2}));u.push({k:e.get(o[r])-this.getMinDist(o[r],o[m]),v:a})}for(n&&u.push({k:e.get(n)-this.getMinDist(n,o[m]),v:Number.MAX_VALUE}),u.sort(this._positionAscendingComparer),h=0,p=0,f=this.getMinDist(o[m-1],o[m]);e.get(o[m])-e.get(o[m-1])<f;)if(p>h){if(0===v.length){e.set(o[m-1],e.get(o[m])-f);break}c=v.shift(),h+=c.v,e.set(o[m-1],c.k),e.set(o[m-1],Math.max(e.get(o[m-1]),e.get(o[m])-f))}else{if(0===u.length){e.set(o[m],e.get(o[m-1])+f);break}c=u.shift(),p+=c.v,e.set(o[m],c.k),e.set(o[m],Math.min(e.get(o[m]),e.get(o[m-1])+f))}for(r=m-2;r>=0;r--)e.set(o[r],Math.min(e.get(o[r]),e.get(o[m-1])-this.getMinDist(o[r],o[m-1])));for(r=m+1;g>r;r++)e.set(o[r],Math.max(e.get(o[r]),e.get(o[m])+this.getMinDist(o[r],o[m])))},placeLeft:function(e,t,n){var i=Number.NEGATIVE_INFINITY;h.forEach(this._getComposite(e),function(e){var o=this.leftSibling(e);o&&this.nodeLeftClass.get(o)===this.nodeLeftClass.get(e)&&(t.containsKey(o)||this.placeLeft(o,t,n),i=Math.max(i,t.get(o)+this.getMinDist(o,e)))},this),i===Number.NEGATIVE_INFINITY&&(i=0),h.forEach(this._getComposite(e),function(e){t.set(e,i)})},placeRight:function(e,t,n){var i=Number.POSITIVE_INFINITY;h.forEach(this._getComposite(e),function(e){var o=this.rightSibling(e);o&&this.nodeRightClass.get(o)===this.nodeRightClass.get(e)&&(t.containsKey(o)||this.placeRight(o,t,n),i=Math.min(i,t.get(o)-this.getMinDist(e,o)))},this),i===Number.POSITIVE_INFINITY&&(i=0),h.forEach(this._getComposite(e),function(e){t.set(e,i)})},leftSibling:function(e){var t=this.layers[e.layer],n=e.layerIndex;return 0===n?null:t[n-1]},rightSibling:function(e){var t=this.layers[e.layer],n=e.layerIndex;return n===t.length-1?null:t[n+1]},_getComposite:function(e){return e.isVirtual?this._nodesInLink(e):[e]},arrangeNodes:function(){var e,t,n,i,o,r,a,s;for(t=0;this.layers.length>t;t++)for(i=this.layers[t],n=0;i.length>n;n++)o=i[n],o.upstreamPriority=o.upstreamLinkCount,o.downstreamPriority=o.downstreamLinkCount;for(r=2,a=0;r>a;a++){for(e=this.layers.length-1;e>=1;e--)this.layoutLayer(!1,e);for(e=0;this.layers.length-1>e;e++)this.layoutLayer(!0,e)}for(s=Number.MAX_VALUE,t=0;this.layers.length>t;t++)for(i=this.layers[t],n=0;i.length>n;n++)o=i[n],s=Math.min(s,o.gridPosition);if(0>s)for(t=0;this.layers.length>t;t++)for(i=this.layers[t],n=0;i.length>n;n++)o=i[n],o.gridPosition=o.gridPosition-s},layoutLayer:function(e,t){var n,i,o,r;for(i=e?this.layers[n=t+1]:this.layers[n=t-1],o=[],r=0;i.length>r;r++)o.push(i[r]);o.sort(function(e,t){var n=(e.upstreamPriority+e.downstreamPriority)/2,i=(t.upstreamPriority+t.downstreamPriority)/2;return Math.abs(n-i)<1e-4?0:i>n?1:-1}),h.forEach(o,function(e){var t=e.gridPosition,n=this.calcBaryCenter(e),o=(e.upstreamPriority+e.downstreamPriority)/2;if(!(Math.abs(t-n)<1e-4||Math.abs(t-n)<.2501))if(n>t)for(;n>t&&this.moveRight(e,i,o);)t=e.gridPosition;else for(;t>n&&this.moveLeft(e,i,o);)t=e.gridPosition},this),n>0&&this.calcDownData(n-1),this.layers.length-1>n&&this.calcUpData(n+1)},moveRight:function(e,t,n){var i,o,r=h.indexOf(t,e);return r===t.length-1?(e.gridPosition=e.gridPosition+.5,!0):(i=t[r+1],o=(i.upstreamPriority+i.downstreamPriority)/2,i.gridPosition>e.gridPosition+1?(e.gridPosition=e.gridPosition+.5,!0):o>n||Math.abs(o-n)<1e-4?!1:this.moveRight(i,t,n)?(e.gridPosition=e.gridPosition+.5,!0):!1)},moveLeft:function(e,t,n){var i,o,r=h.indexOf(t,e);return 0===r?(e.gridPosition=e.gridPosition-.5,!0):(i=t[r-1],o=(i.upstreamPriority+i.downstreamPriority)/2,e.gridPosition-1>i.gridPosition?(e.gridPosition=e.gridPosition-.5,!0):o>n||Math.abs(o-n)<1e-4?!1:this.moveLeft(i,t,n)?(e.gridPosition=e.gridPosition-.5,!0):!1)},mapVirtualNode:function(e,t){this.nodeToLinkMap.set(e,t),this.linkToNodeMap.containsKey(t)||this.linkToNodeMap.set(t,[]),this.linkToNodeMap.get(t).push(e)},_nodesInLink:function(e){return this.linkToNodeMap.get(this.nodeToLinkMap.get(e))},_dummify:function(){var e,t,n,i,a,s,l,c,u,p,f,g,m,v,_,y,w,b;for(this.linkToNodeMap=new d,this.nodeToLinkMap=new d,u=this.graph.links.slice(0),c=0;u.length>c;c++){if(p=u[c],f=p.source,g=p.target,m=f.layer,v=g.layer,_=f.gridPosition,y=g.gridPosition,w=(y-_)/Math.abs(v-m),b=f,m-v>1){for(l=m-1;l>v;l--){for(n=new o,n.x=f.x,n.y=f.y,n.width=f.width/100,n.height=f.height/100,e=this.layers[l],t=(l-v)*w+_,t>e.length&&(t=e.length),_>=this.layers[m].length-1&&y>=this.layers[v].length-1?t=e.length:0===_&&0===y&&(t=0),n.layer=l,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamLinkCount=0,n.downstreamLinkCount=0,n.gridPosition=t,n.isVirtual=!0,h.insert(e,n,t),a=t+1;e.length>a;a++)i=e[a],i.gridPosition=i.gridPosition+1;s=new r(b,n),s.depthOfDumminess=0,b=n,this.graph.nodes.push(n),this.graph.addLink(s),n.index=this.graph.nodes.length-1,this.mapVirtualNode(n,p)}p.changeSource(b),p.depthOfDumminess=m-v-1}if(-1>m-v){for(l=m+1;v>l;l++){for(n=new o,n.x=f.x,n.y=f.y,n.width=f.width/100,n.height=f.height/100,e=this.layers[l],t=(l-m)*w+_,t>e.length&&(t=e.length),_>=this.layers[m].length-1&&y>=this.layers[v].length-1?t=e.length:0===_&&0===y&&(t=0),n.layer=l,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamLinkCount=0,n.downstreamLinkCount=0,n.gridPosition=t,n.isVirtual=!0,t&=t,h.insert(e,n,t),a=t+1;e.length>a;a++)i=e[a],i.gridPosition=i.gridPosition+1;s=new r(b,n),s.depthOfDumminess=0,b=n,this.graph.nodes.push(n),this.graph.addLink(s),n.index=this.graph.nodes.length-1,this.mapVirtualNode(n,p)}p.changeSource(b),p.depthOfDumminess=v-m-1}}},_dedummify:function(){for(var e,t,n,i,o,r,a,s,l=!0;l;)for(l=!1,e=0;this.graph.links.length>e;e++)if(t=this.graph.links[e],0!==t.depthOfDumminess){for(n=[],n.unshift({x:t.target.x,y:t.target.y}),n.unshift({x:t.source.x,y:t.source.y}),i=t,o=t.depthOfDumminess,r=0;o>r;r++)a=i.source,s=a.incoming[0],n.unshift({x:s.source.x,y:s.source.y}),i=s;t.changeSource(i.source),t.depthOfDumminess=0,n.length>2?(n.splice(0,1),n.splice(n.length-1),t.points=n):t.points=[],l=!0;break}},_optimizeCrossings:function(){for(var e,t=-1,n=3,i=0;0!==t&&!(i++>n);){for(t=0,e=this.layers.length-1;e>=1;e--)t+=this.optimizeLayerCrossings(!1,e);for(e=0;this.layers.length-1>e;e++)t+=this.optimizeLayerCrossings(!0,e)}},calcUpData:function(e){var t,n,i,o,r,a,s,l,d;if(0!==e){for(t=this.layers[e],r=new c,a=this.layers[e-1],n=0;a.length>n;n++)r.add(a[n]);for(n=0;t.length>n;n++){for(s=t[n],l=0,d=0,i=0;s.incoming.length>i;i++)o=s.incoming[i],r.contains(o.source)&&(d++,l+=o.source.gridPosition);for(i=0;s.outgoing.length>i;i++)o=s.outgoing[i],r.contains(o.target)&&(d++,l+=o.target.gridPosition);d>0?(s.uBaryCenter=l/d,s.upstreamLinkCount=d):(s.uBaryCenter=n,s.upstreamLinkCount=0)}}},calcDownData:function(e){var t,n,i,o,r,a,s,l,d;if(e!==this.layers.length-1){for(t=this.layers[e],r=new c,a=this.layers[e+1],n=0;a.length>n;n++)r.add(a[n]);for(n=0;t.length>n;n++){for(s=t[n],l=0,d=0,i=0;s.incoming.length>i;i++)o=s.incoming[i],r.contains(o.source)&&(d++,l+=o.source.gridPosition);for(i=0;s.outgoing.length>i;i++)o=s.outgoing[i],r.contains(o.target)&&(d++,l+=o.target.gridPosition);d>0?(s.dBaryCenter=l/d,s.downstreamLinkCount=d):(s.dBaryCenter=n,s.downstreamLinkCount=0)}}},optimizeLayerCrossings:function(e,t){var n,i,o,r,a,s,l,d;for(i=e?this.layers[n=t+1]:this.layers[n=t-1],o=i.slice(0),e?this.calcUpData(n):this.calcDownData(n),r=this,i.sort(function(e,t){var n,i=r.calcBaryCenter(e),o=r.calcBaryCenter(t);return Math.abs(i-o)<1e-4?e.degree()===t.degree()?r.compareByIndex(e,t):e.degree()<t.degree()?1:-1:(n=1e3*(o-i),n>0?-1:0>n?1:r.compareByIndex(e,t))}),s=0,a=0;i.length>a;a++)i[a]!==o[a]&&s++;if(s>0)for(l=0,a=0;i.length>a;a++)d=i[a],d.gridPosition=l++;return s},_swapPairs:function(){for(var e,t,n,i,o,r,a,s,l,d,c,u,h,p,f,g,m,v=this.options.layeredIterations,_=0;;){if(_++>v)break;for(e=1>=_%4,t=_%4===1,n=e?0:this.layers.length-1;e?this.layers.length-1>=n:n>=0;n+=e?1:-1){for(i=this.layers[n],o=!1,r=!0,a=0,s=0;i.length-1>s;s++)l=0,d=0,c=0,r?(0!==n&&(l=this.countLinksCrossingBetweenTwoLayers(n-1,n)),n!==this.layers.length-1&&(d=this.countLinksCrossingBetweenTwoLayers(n,n+1)),e?l*=2:d*=2,c=l+d):c=a,0!==c&&(u=i[s],h=i[s+1],p=u.gridPosition,f=h.gridPosition,i[s]=h,i[s+1]=u,u.gridPosition=f,h.gridPosition=p,l=0,0!==n&&(l=this.countLinksCrossingBetweenTwoLayers(n-1,n)),d=0,n!==this.layers.length-1&&(d=this.countLinksCrossingBetweenTwoLayers(n,n+1)),e?l*=2:d*=2,g=l+d,m=!1,m=t?g>=c:g>c,m?(u=i[s],h=i[s+1],p=u.gridPosition,f=h.gridPosition,i[s]=h,i[s+1]=u,u.gridPosition=f,h.gridPosition=p,a=c,r=!1):(o=!0,r=!0));o&&(n!==this.layers.length-1&&this.calcUpData(n+1),0!==n&&this.calcDownData(n-1))}}},countLinksCrossingBetweenTwoLayers:function(e,t){var n,i,o,r,a,s,l,d,u,p,f,g,m,v,_,y,w,b,k,x,C=0,T=new c,S=this.layers[e];for(n=0;S.length>n;n++)T.add(S[n]);for(i=new c,o=this.layers[t],n=0;o.length>n;n++)i.add(o[n]);for(r=new c,a=[],s=[],T.forEach(function(e){h.addRange(s,e.incoming),h.addRange(s,e.outgoing)}),l=0;s.length>l;l++)d=s[l],T.contains(d.source)&&i.contains(d.target)?(r.add(d),a.push(d)):i.contains(d.source)&&T.contains(d.target)&&a.push(d);for(u=0;a.length>u;u++)for(p=a[u],f=0;a.length>f;f++)u!==f&&(g=a[f],r.contains(p)?(m=p.source,v=p.target):(m=p.target,v=p.source),r.contains(g)?(_=g.source,y=g.target):(_=g.target,y=g.source),w=m.gridPosition,b=v.gridPosition,k=_.gridPosition,x=y.gridPosition,0>(w-k)*(b-x)&&C++);return C/2},calcBaryCenter:function(e){var t=e.upstreamLinkCount,n=e.downstreamLinkCount,i=e.uBaryCenter,o=e.dBaryCenter;return t>0&&n>0?(i+o)/2:t>0?i:n>0?o:0},_gridPositionComparer:function(e,t){return t.gridPosition>e.gridPosition?-1:e.gridPosition>t.gridPosition?1:0
},_positionAscendingComparer:function(e,t){return t.k>e.k?-1:e.k>t.k?1:0},_positionDescendingComparer:function(e,t){return t.k>e.k?1:e.k>t.k?-1:0},_firstVirtualNode:function(e){for(var t=0;e.length>t;t++)if(e[t].isVirtual)return t;return-1},compareByIndex:function(e,t){var n=e.index,i=t.index;return i>n?1:n>i?-1:0},intDiv:function(e,t){return(e-e%t)/t},nextVirtualNode:function(e,t){var n,i=t.layerIndex;for(n=i+1;e.length>n;++n)if(e[n].isVirtual)return e[n];return null}}),C=t.Class.extend({init:function(e,t){if(h.isUndefined(e))throw"No diagram given";this.diagram=e,this.nodeMap=new d,this.linkMap=new d,this.capture(t?t:e)},capture:function(e){var t,i,o,r,a,s,d,c,u;if(e instanceof n.Graph){for(r=0;e.nodes.length>r;r++)t=e.nodes[r],o=t.associatedShape,this.nodeMap.set(o.visual.domElement.id,new l(t.x,t.y,t.width,t.height));for(r=0;e.links.length>r;r++)s=e.links[r],a=s.associatedConnection,this.linkMap.set(a.visual.domElement.id,s.points())}else if(e instanceof Array)for(i=e,r=0;i.length>r;r++)t=i[r],o=t.associatedShape,o&&this.nodeMap.set(o.visual.domElement.id,new l(t.x,t.y,t.width,t.height));else if(e.hasOwnProperty("links")&&e.hasOwnProperty("nodes")){for(i=e.nodes,d=e.links,r=0;i.length>r;r++)t=i[r],o=t.associatedShape,o&&this.nodeMap.set(o.visual.domElement.id,new l(t.x,t.y,t.width,t.height));for(r=0;d.length>r;r++)s=d[r],a=s.associatedConnection,a&&this.linkMap.set(a.visual.domElement.id,s.points)}else{for(c=this.diagram.shapes,u=this.diagram.connections,r=0;c.length>r;r++)o=c[r],this.nodeMap.set(o.visual.domElement.id,o.bounds());for(r=0;u.length>r;r++)a=u[r],this.linkMap.set(a.visual.domElement.id,a.points())}}});a(n,{init:function(e){t.init(e,n.ui)},SpringLayout:w,TreeLayout:k,GraphAdapter:y,LayeredLayout:x,LayoutBase:_,LayoutState:C})}(window.kendo.jQuery),function(e,t){function n(e){return e.options.name.toLowerCase()===at.toLowerCase()}function i(e){var t,i,r,a,s,d,c,u,h,p,f=ut,g=e.source(),m=e.target(),v=[0,2,3,1,4];if(g instanceof I?t=g:g instanceof l&&(n(g)?r=g.shape:(e._resolvedSourceConnector=g,t=g.position())),m instanceof I?i=m:m instanceof l&&(n(m)?a=m.shape:(e._resolvedTargetConnector=m,i=m.position())),t)a&&(e._resolvedTargetConnector=o(t,a));else if(r)if(i)e._resolvedSourceConnector=o(i,r);else if(a)for(c=0;r.connectors.length>c;c++)d=5==r.connectors.length?v[c]:c,s=r.connectors[d],n(s)||(u=s.position(),h=o(u,a),p=Math.round(h.position().distanceTo(u)),f>p&&(f=p,e._resolvedSourceConnector=s,e._resolvedTargetConnector=h))}function o(e,t){var i,o,r,a,s=ut,l=t.connectors;for(o=0;l.length>o;o++)r=l[o],n(r)||(a=e.distanceTo(r.position()),s>a&&(s=a,i=r));return i}function r(e,t){var n,i,o,r,a=[];for(n=0;t.length>n;n++)for(i=t[n],o=0;e.children.length>o;o++)if(r=e.children[o],r==i.domElement){a.push(o);break}return a}var a,s,l,d,c,u,h=kendo.dataviz,p=h.diagram,f=kendo.ui.Widget,g=kendo.Class,m=e.proxy,v=kendo.deepExtend,_=kendo.data.HierarchicalDataSource,y=p.Canvas,w=p.Group,b=p.Visual,k=p.Rectangle,x=p.Circle,C=p.CompositeTransform,T=p.Rect,S=p.Path,D=p.DeleteShapeUnit,A=p.DeleteConnectionUnit,E=p.TextBlock,P=p.Image,I=p.Point,z=p.Intersect,M=p.ConnectionEditAdorner,F=p.UndoRedoService,L=p.ToolService,B=p.Selector,R=p.ResizingAdorner,H=p.ConnectorsAdorner,O=p.Cursors,N=p.Utils,V=kendo.Observable,U=p.Ticker,W=p.ToBackUnit,j=p.ToFrontUnit,q=p.Dictionary,G=p.PolylineRouter,Y=p.CascadingRouter,Q=N.isUndefined,K=N.isDefined,$=e.isArray,X=kendo.isFunction,Z=N.isString,J=".kendoDiagram",et="Cascading",tt="Polyline",nt="itemBoundsChange",it="change",ot="click",rt="error",at="Auto",st="Top",lt="Right",dt="Left",ct="Bottom",ut=9007199254740992,ht="select",pt="itemRotate",ft="pan",gt="zoomStart",mt="zoomEnd",vt="single",_t="none",yt="multiple",wt="rectangle",bt=100,kt=100,xt=20,Ct=20,Tt=0,St="Yellow",Dt=Number.MAX_VALUE,At=-Number.MAX_VALUE,Et="all",Pt="absolute",It="transformed",zt="rotated";p.DefaultConnectors=[{name:st,description:"Top Connector"},{name:lt,description:"Right Connector"},{name:ct,description:"Bottom Connector"},{name:dt,Description:"Left Connector"},{name:at,Description:"Auto Connector",position:function(e){return e.getPosition("center")}}],p.shapeDefaults=function(e){var t={type:wt,path:"",visual:null,x:Tt,y:Tt,minWidth:xt,minHeight:Ct,width:bt,height:kt,hover:{},connectors:p.DefaultConnectors,rotation:{angle:0}};return N.simpleExtend(t,e),t},a=kendo.Class.extend({init:function(e){this.pan=e.pan,this.diagram=e.diagram},initState:function(){this.from=this.diagram.pan(),this.to=this.pan},update:function(e){var t=this.diagram;t._storePan(new I(this.from.x+(this.to.x-this.from.x)*e,this.from.y+(this.to.y-this.from.y)*e)),t._transformMainLayer()}}),s=V.extend({init:function(e,t){var n=this;V.fn.init.call(n),n.options=v({id:p.randomId()},n.options,e),n.isSelected=!1,n.model=t,n.visual=new w({id:n.options.id}),n._template()},options:{background:"Green",hover:{},cursor:O.grip,content:{align:"center middle",text:""},selectable:!0,serializable:!0,enable:!0},_getCursor:function(e){return this.adorner?this.adorner._getCursor(e):this.options.cursor},visible:function(e){return Q(e)?this.visual.visible():(this.visual.visible(e),t)},bounds:function(){},refresh:function(){this.visual.redraw()},position:function(e){this.options.x=e.x,this.options.y=e.y,this.visual.position(e)},toString:function(){return this.options.id},serialize:function(){var e=v({},{options:this.options});return this.model&&(e.model=""+this.model),e},content:function(e){if(e!==t){var n=this.bounds(),i=v({text:"",width:n.width,height:n.height},this.options.content);p.Utils.isString(e)?(this.options.content.text=e,i.text=e):this.options.content=i,this.shapeVisual instanceof E&&(this._contentVisual=this.shapeVisual),!this._contentVisual&&this.options.content.text&&(this._contentVisual=new E,this.visual.append(this._contentVisual)),this._contentVisual&&this._contentVisual.redraw(i)}return this.options.content.text},_hitTest:function(e){var t=this.bounds();return this.visible()&&t.contains(e)&&this.options.enable},_template:function(){var e,t,n=this;n.options.content.template&&(e=n.model||{},t=kendo.template(n.options.content.template,{paramName:"item"}),n.options.content.text=t(e))},_canSelect:function(){return this.options.selectable&&this.diagram.options.selectable.type!==_t}}),l=g.extend({init:function(e,t){this.options=v({},this.options,t),this.connections=[],this.shape=e},options:{width:7,height:7,background:St,hover:{}},position:function(){return this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name)},toString:function(){return{shapeId:""+this.shape,connector:this.options.name}}}),l.parse=function(e,t){var n,i,o=t.split(":"),r=o[0],a=o[1]||at;for(n=0;e.shapes.length>n;n++)if(i=e.shapes[n],i.options.id==r)return i.getConnector(a.trim())},d=s.extend({init:function(e,n){var i=this,o=e.diagram;delete e.diagram,s.fn.init.call(i,e,n),i.options.diagram=o,e=i.options,i.connectors=[],i.type=e.type,i.shapeVisual=d.createShapeVisual(i.options),i.visual.append(this.shapeVisual),i.bounds(new T(e.x,e.y,Math.floor(e.width),Math.floor(e.height))),i._createConnectors(),i.parentContainer=null,i.isContainer=!1,i.isCollapsed=!1,i.id=i.visual.domElement.id,i.content(i.content()),i._rotate(),e.hasOwnProperty("layout")&&e.layout!==t&&(i.layout=e.layout.bind(e))},options:p.shapeDefaults(),_createConnectors:function(){var e,t,n=this.options,i=n.connectors.length,o=n.connectorDefaults;for(t=0;i>t;t++)e=new l(this,v({},o,n.connectors[t])),this.connectors.push(e)},bounds:function(e){var t,n,i,o,r=this.options;if(e)if(Z(e))switch(e){case It:i=this._transformedBounds();break;case Pt:i=this._transformedBounds(),o=this.diagram._pan,i.x+=o.x,i.y+=o.y;break;case zt:i=this._rotatedBounds();break;default:i=this._bounds}else t=e.topLeft(),r.x=t.x,r.y=t.y,r.width=Math.max(e.width,r.minWidth),r.height=Math.max(e.height,r.minHeight),this._bounds=new T(r.x,r.y,r.width,r.height),this.visual.position(t),this.redraw({width:r.width,height:r.height}),this.refreshConnections(),this._triggerBoundsChange();else i=this._bounds;return this.shapeVisual._measured||(n=this.shapeVisual._measure(),n&&(this.shapeVisual.options.autoSize?this.bounds(new T(r.x,r.y,n.width,n.height)):this.shapeVisual.redraw())),i},position:function(e){return e?(this.bounds(new T(e.x,e.y,this._bounds.width,this._bounds.height)),t):this._bounds.topLeft()},clone:function(){var e,t=this.serialize();return t.options.id=p.randomId(),e=new d(t.options),e.diagram=this.diagram,e},select:function(e){var n,i,o,r=this.diagram;return Q(e)&&(e=!0),this._canSelect()&&this.isSelected!=e?(o=this.diagram.options.selectable.type,n=[],i=[],this.isSelected=e,this.isSelected?(o===vt&&this.diagram.select(!1),r._selectedItems.push(this),n.push(this)):(N.remove(r._selectedItems,this),i.push(this)),r._internalSelection||r._selectionChanged(n,i),!0):t},rotate:function(e,n){var i,o,r,a,s=this.visual.rotate();return e!==t&&(i=this.bounds(),o=new I(i.width/2,i.height/2),n&&(r=e-s.angle,a=i.center().rotate(n,360-r).minus(o),this._rotationOffset=this._rotationOffset.plus(a.minus(i.topLeft())),this.position(a)),this.visual.rotate(e,o),this.options.rotation.angle=e,this.diagram&&this.diagram._connectorsAdorner&&this.diagram._connectorsAdorner.refresh(),this.refreshConnections(),this.diagram&&this.diagram.trigger(pt,{item:this})),s},connections:function(e){var t,n,i,o,r,a,s,l=[];for(t=0;this.connectors.length>t;t++)for(r=this.connectors[t],o=r.connections,n=0,o;o.length>n;n++)i=o[n],"out"==e?(a=i.source(),a.shape&&a.shape==this&&l.push(i)):"in"==e?(s=i.target(),s.shape&&s.shape==this&&l.push(i)):l.push(i);return l},refreshConnections:function(){e.each(this.connections(),function(){this.refresh()})},getConnector:function(e){var t,n;if(!Z(e))return e instanceof I?o(e,this):this.connectors.length?this.connectors[0]:null;for(e=e.toLocaleLowerCase(),t=0;this.connectors.length>t;t++)if(n=this.connectors[t],n.options.name.toLocaleLowerCase()==e)return n},getPosition:function(e){var t=this.bounds(),n=e[0].toLowerCase()+e.slice(1);return X(t[n])?this._transformPoint(t[n]()):t.center()},redraw:function(e){e&&(this.options=v({},this.options,e)),this._contentVisual&&this._contentVisual.redraw({width:this.options.width,height:this.options.height}),this.shapeVisual.redraw(e),e&&e.content&&this.content(e.content)},_triggerBoundsChange:function(){this.diagram&&this.diagram.trigger(nt,{item:this,bounds:this._bounds.clone()})},_transformPoint:function(e){var t=this.rotate(),n=this.bounds(),i=n.topLeft();return t.angle&&e.rotate(t.center().plus(i),360-t.angle),e},_transformedBounds:function(){var e=this.bounds(),t=e.topLeft(),n=e.bottomRight();return T.fromPoints(this.diagram.modelToView(t),this.diagram.modelToView(n))},_rotatedBounds:function(){var e=this.bounds().rotatedBounds(this.rotate().angle),t=e.topLeft(),n=e.bottomRight();return T.fromPoints(t,n)},_rotate:function(){var e=this.options.rotation;e&&e.angle&&this.rotate(e.angle),this._rotationOffset=new I},_hover:function(e){var t=this.options,n=t.hover,i=t.stroke,o=t.background;e&&K(n.stroke)&&(i=v({},i,n.stroke)),e&&K(n.background)&&(o=n.background),this.shapeVisual.redraw({stroke:i,background:o}),this.diagram._showConnectors(this,e)},_hitTest:function(e){if(this.visible()){var t,n=this.bounds(),i=this.rotate().angle;if(e.isEmpty&&!e.isEmpty())return z.rects(e,n,i?i:0);if(t=e.clone().rotate(n.center(),i),n.contains(t))return this}}}),d.createShapeVisual=function(e){function n(e,t,n){var i,o,r,a;if(u.libraries&&u.libraries.length>0)for(i=0;u.libraries.length>i;i++)for(o=u.libraries[i],r=0;o.length>r;r++)if(a=o[r],a.options.name===e&&"external"===a.options.serializationSource)return t.layout=a.options.layout,t.visual=a.options.visual,t.rebuild=a.options.rebuild,a.options.visual(n)}function i(e,t){switch(e.toLocaleLowerCase()){case"rectangle":return new k(t);case"circle":return new x(t);case"text":return new E(t);case"image":return new P(t);case"svg":return a(t.definition);default:var n=new S(t);return n}}function o(e,t){return t.data=e,new S(t)}function r(e,t,n){return e.call(t,n)}function a(e){var t='<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">'+e+"</svg>",n=c(t),i=document.importNode(n.childNodes[0].childNodes[0],!0),o=new w;return o.append(new b(i)),o}var s,l,d,c,u=e.diagram;if(delete e.diagram,s=v({},e,{x:0,y:0}),l=s.visual,d=s.type,t!==window.DOMParser)c=function(e){return(new window.DOMParser).parseFromString(e,"image/svg+xml")};else{if(t===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw Error("No XML parser found");c=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}}return kendo.isFunction(l)||"external"!==s.serializationSource?s.path?o(s.path,s):X(l)?r(l,this,s):Z(d)?i(s.type.toLocaleLowerCase(),s):new k(s):n(s.name,e,s)},c=s.extend({init:function(e,t,n,i){var o=this;s.fn.init.call(o,n,i),o._router=new G(this),o.path=new S(o.options),o.path.background(_t),o.visual.append(o.path),o._sourcePoint=o._targetPoint=new I,o.source(e),o.target(t),o.content(o.options.content.text),o.definers=[],K(n)&&n.points&&o.points(n.points),o.refresh()},options:{hover:{stroke:{}},startCap:_t,endCap:_t,points:[],selectable:!0},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint},source:function(e,n){return K(e)&&(n&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new p.ConnectionEditUnit(this,e)):(e!==t&&(this.from=e),null===e?this.sourceConnector&&(this._sourcePoint=this._resolvedSourceConnector.position(),this._clearSourceConnector()):e instanceof l?(this.sourceConnector=e,this.sourceConnector.connections.push(this),this.refresh()):e instanceof I?(this._sourcePoint=e,this.sourceConnector&&this._clearSourceConnector(),this.refresh()):e instanceof d&&(this.sourceConnector=e.getConnector(at),this.sourceConnector.connections.push(this),this.refresh()))),this.sourceConnector?this.sourceConnector:this._sourcePoint},sourceDefiner:function(e){if(!e)return this._sourceDefiner||(this._sourceDefiner=new p.PathDefiner(this.sourcePoint(),null,null)),this._sourceDefiner;if(!(e instanceof p.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";e.left=null,this._sourceDefiner=e,this.source(e.point)},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint},target:function(e,n){return K(e)&&(n&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new p.ConnectionEditUnit(this,e)):(e!==t&&(this.to=e),null===e?this.targetConnector&&(this._targetPoint=this._resolvedTargetConnector.position(),this._clearTargetConnector()):e instanceof l?(this.targetConnector=e,this.targetConnector.connections.push(this),this.refresh()):e instanceof I?(this._targetPoint=e,this.targetConnector&&this._clearTargetConnector(),this.refresh()):e instanceof d&&(this.targetConnector=e.getConnector(at),this.targetConnector&&(this.targetConnector.connections.push(this),this.refresh())))),this.targetConnector?this.targetConnector:this._targetPoint},targetDefiner:function(e){if(!e)return this._targetDefiner||(this._targetDefiner=new p.PathDefiner(this.targetPoint(),null,null)),this._targetDefiner;if(!(e instanceof p.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";e.right=null,this._targetDefiner=e,this.target(e.point)},content:function(e){var t=s.fn.content.call(this,e);return this.refresh(),t},select:function(e){var n,i,o,r=this.diagram;return this._canSelect()&&this.isSelected!==e?(this.isSelected=e,n=[],i=[],o=this.diagram.options.selectable.type,this.isSelected?(o===vt&&this.diagram.select(!1),this.adorner=new M(this,this.options.select),r._adorn(this.adorner,!0),r._selectedItems.push(this),n.push(this)):this.adorner&&(r._adorn(this.adorner,!1),N.remove(r._selectedItems,this),this.adorner=t,i.push(this)),this.refresh(),r._internalSelection||r._selectionChanged(n,i),!0):t},bounds:function(e){return!e||Z(e)?this._bounds:(this._bounds=e,t)},type:function(e){if(!e)return this._type;if(e!==this._type){switch(this._type=e,e.toLowerCase()){case et.toLowerCase():this._router=new Y(this);break;case tt.toLowerCase():this._router=new G(this);break;default:throw"Unsupported connection type."}this.refresh()}},points:function(e){var t,n,i,o;if(!e){if(i=[],K(this.definers))for(o=0;this.definers.length>o;o++)i.push(this.definers[o].point);return i}for(this.definers=[],t=0;e.length>t;t++)if(n=e[t],n instanceof p.Point)this.definers.push(new p.PathDefiner(n));else{if(!n.hasOwnProperty("x")||!n.hasOwnProperty("y"))throw"A Connection point needs to be a Point or an object with x and y properties.";this.definers.push(new p.PathDefiner(new I(n.x,n.y)))}},allPoints:function(){var e,t=[this.sourcePoint()];if(this.definers)for(e=0;this.definers.length>e;e++)t.push(this.definers[e].point);return t.push(this.targetPoint()),t},refresh:function(){i(this);var e,t,n,o,r=this.sourcePoint(),a=this.targetPoint();this._refreshPath(),e=this._bounds.topLeft(),t=r.minus(e),n=a.minus(e),this._contentVisual&&(o=I.fn.middleOf(t,n),this._contentVisual.position(new I(o.x+e.x,o.y+e.y))),this.adorner&&this.adorner.refresh()},redraw:function(e){this.options=v({},this.options,e),this.content(this.options.content.text),K(this.options.points)&&this.options.points.length>0&&(this.points(this.options.points),this._refreshPath()),this.path.redraw(e)},clone:function(){var e=this.serialize(),t=new c(this.from,this.to,e.options);return t.diagram=this.diagram,t},serialize:function(){var e=v({},{options:this.options,from:""+this.from,to:""+this.to});return this.model&&(e.model=""+this.model),e.options.points=this.points(),e},_hitTest:function(e){if(this.visible()){var t=new I(e.x,e.y),n=this.sourcePoint(),i=this.targetPoint();if(e.isEmpty&&!e.isEmpty()&&e.contains(n)&&e.contains(i))return this;if(this._router.hitTest(t))return this}},_hover:function(e){var t=(this.options.stroke||{}).color;e&&K(this.options.hover.stroke.color)&&(t=this.options.hover.stroke.color),this.path.redraw({stroke:{color:t}})},_calcPathData:function(){function e(e){return e.x+" "+e.y}var t,n,i,o,r,a;for(this._router&&this._router.route(),t=this.sourcePoint(),n=this.targetPoint(),i="M"+e(t),o=this.points(),r=0;o.length>r;r++)a=o[r],i+=" L"+e(a);return i+" L"+e(n)},_refreshPath:function(){Q(this.path)||(this._drawPath(this._calcPathData()),this.bounds(this._router.getBounds()))},_drawPath:function(e){this.path.redraw({data:e})},_clearSourceConnector:function(){N.remove(this.sourceConnector.connections,this),this.sourceConnector=t,this._resolvedSourceConnector=t},_clearTargetConnector:function(){N.remove(this.targetConnector.connections,this),this.targetConnector=t,this._resolvedTargetConnector=t}}),u=f.extend({init:function(t,n){var i,o=this;kendo.destroy(t),f.fn.init.call(o,t,n),t=o.element,t.empty(),o._initTheme(),o._extendLayoutOptions(o.options),o.element.addClass("k-widget k-diagram").attr("role","diagram"),i=e("<div class='k-canvas-container'></div>").appendTo(t)[0],o.canvas=new y(i),o.options.useScroller&&(o.scrollable=e("<div />").appendTo(o.element).append(o.canvas.element)),this.mainLayer=new w({id:"main-layer"}),this.canvas.append(this.mainLayer),this.adornerLayer=new w({id:"adorner-layer"}),this.canvas.append(this.adornerLayer),this.libraries=[],this.toolService=new L(this),this._attachEvents(),o._initialize(),o._fetchFreshData(),this._resizingAdorner=new R(this,{editable:this.options.editable}),this._connectorsAdorner=new H(this),this._adorn(this._resizingAdorner,!0),this._adorn(this._connectorsAdorner,!0),o.element.on("mousemove"+J,m(o._mouseMove,o)).on("mouseup"+J,m(o._mouseUp,o)).on("dblclick"+J,m(o._doubleClick,o)).on("mousedown"+J,m(o._mouseDown,o)).mousewheel(m(o._wheel,o),{ns:J}).on("keydown"+J,m(o._keydown,o)).on("mouseover"+J,m(o._mouseover,o)).on("mouseout"+J,m(o._mouseout,o)),o.selector=new B(o),o._clipboard=[],o._initEditor(),o._autosizeCanvas(),o.options.layout&&o.layout(o.options.layout),this.pauseMouseHandlers=!1,o._createShapes(),o._createConnections()},options:{name:"Diagram",theme:"default",zoomRate:.1,zoom:1,minZoom:0,maxZoom:2,dataSource:{},draggable:!0,template:"",autoBind:!0,editable:{rotate:{},resize:{},text:!0},useScroller:!0,tooltip:{enabled:!0,format:"{0}"},copy:{enabled:!0,offsetX:20,offsetY:20},editor:{height:20,margin:10,fontSize:15},selectable:{type:yt,inclusive:!0},snap:{enabled:!0,size:10,angle:10},shapeDefaults:p.shapeDefaults({undoable:!0}),connectionDefaults:{},shapes:[],connections:[]},events:[mt,gt,ft,ht,pt,nt,it,ot],_mouseover:function(e){e.target._hover&&e.target._hover(!0,e.target._kendoElement)},_mouseout:function(e){e.target._hover&&e.target._hover(!1,e.target._kendoElement)},_initTheme:function(){var e=this,t=h.ui.themes||{},n=((e.options||{}).theme||"").toLowerCase(),i=(t[n]||{}).diagram;e.options=v({},i,e.options)},_createShapes:function(){var e,t,n=this,i=n.options,o=i.shapes;for(t=0;o.length>t;t++)e=o[t],n.addShape(e)},_createConnections:function(){var e,t,n,i,o=this,r=o.options,a=r.connectionDefaults,s=r.connections;for(i=0;s.length>i;i++)e=s[i],t=o._findConnectionShape(e.from),n=o._findConnectionShape(e.to),o.connect(t,n,v({},a,e))},_findConnectionShape:function(e){var t=this,n=t.getShapeById(e.shapeId);return n.getConnector(e.connector||at)},destroy:function(){var e=this;f.fn.destroy.call(e),e.clear(),e.element.off(J),e.canvas.destroy(!0),e.canvas=t,e.destroyScroller()},destroyScroller:function(){var e=this.scroller;e&&(e.destroy(),e.element.remove(),this.scroller=null)},save:function(){var e,t,n,i,o={};for(o.shapes=[],o.connections=[],e=0;this.shapes.length>e;e++)t=this.shapes[e],t.options.serializable&&o.shapes.push(t.options);for(e=0;this.connections.length>e;e++)n=this.connections[e],i=v({},{from:""+n.from,to:""+n.to},n.options),o.connections.push(i);return o},focus:function(){var e=window.scrollX,t=window.scrollY;this.canvas.focus(),window.scrollTo(e,t)},load:function(e){this.clear(),this.setOptions(e),this._createShapes(),this._createConnections()},clear:function(){var e=this;e.dataSource&&e._unbindDataSource(),e.select(!1),e.mainLayer.clear(),e._initialize()},connect:function(e,t,n){var i=v({},this.options.connectionDefaults,n),o=new c(e,t,i);return this.addConnection(o)},connected:function(e,t){var n,i;for(n=0;this.connections.length>n;n++)if(i=this.connections[n],i.from==e&&i.to==t)return!0;return!1},addConnection:function(e,n){if(n===t&&(n=!0),n){var i=new p.AddConnectionUnit(e,this);this.undoRedoService.add(i)}else e.diagram=this,this.mainLayer.append(e.visual),this.connections.push(e);return e},addShape:function(e,t){var n,i=this.options.shapeDefaults;if(e instanceof d)i=v({},i,t),e.redraw(t),n=e;else{if(e instanceof kendo.Class)return;i=v({},i,e),n=new d(i)}return i.undoable?this.undoRedoService.add(new p.AddShapeUnit(n,this)):(this.shapes.push(n),n.diagram=this,this.mainLayer.append(n.visual)),this.trigger(it,{added:[n],removed:[]}),n.redraw(),n.hasOwnProperty("layout")&&n.layout(n),n},remove:function(e,t){var n,i=$(e);if(Q(t)&&(t=!0),t&&this.undoRedoService.begin(),i)for(e=e.slice(0),n=0;e.length>n;n++)this._removeItem(e[n],t);else(e instanceof d||e instanceof c)&&this._removeItem(e,t);t&&this.undoRedoService.commit(),this.trigger(it,{added:[],removed:i?e:[e]})},undo:function(){this.undoRedoService.undo()},redo:function(){this.undoRedoService.redo()},select:function(e,n){var i,o,r,a,l,d,c,u;if(n=v({addToSelection:!1},n),u=n.addToSelection,e===t)return this._selectedItems;if(this._internalSelection=!0,d=[],l=[],!u)for(;this._selectedItems.length>0;)o=this._selectedItems[0],o.select(!1)&&d.push(o);if(N.isBoolean(e))e!==!1&&this.select(Et);else if(e instanceof T)for(a=e,r=this.shapes.concat(this.connections),i=0;r.length>i;i++)o=r[i],a&&!o._hitTest(a)||!o.options.enable||o.select(!0)&&l.push(o);else if(e instanceof Array)for(i=0;e.length>i;i++)o=e[i],o instanceof s&&o.select(!0)&&l.push(o);else if(e instanceof s)e.select(!0)&&l.push(e);else if(c=(""+e).toLowerCase(),c===_t)this.select(!1);else if(c===Et)for(r=this.shapes.concat(this.connections),i=0;r.length>i;i++)o=r[i],o.select(!0)&&l.push(o);(l.length>0||d.length>0)&&this._selectionChanged(l,d),this._internalSelection=!1},toFront:function(e,t){var n,i,o;e||(e=this._selectedItems.slice()),n=this._getDiagramItems(e),Q(t)||t?(i=r(this.mainLayer.domElement,n.visuals),o=new j(this,e,i),this.undoRedoService.add(o)):(this.mainLayer.toFront(n.visuals),this._fixOrdering(n,!0))},toBack:function(e,t){var n,i,o;e||(e=this._selectedItems.slice()),n=this._getDiagramItems(e),Q(t)||t?(i=r(this.mainLayer.domElement,n.visuals),o=new W(this,e,i),this.undoRedoService.add(o)):(this.mainLayer.toBack(n.visuals),this._fixOrdering(n,!1))},bringIntoView:function(e,t){var n,i,o,r,a=this.viewport();t=v({animate:!1,align:"center middle"},t),e instanceof s?n=e.bounds(It):$(e)?n=this.boundingBox(e):e instanceof T&&(n=e.clone()),"none"===t.align&&a.contains(n.center())||("none"===t.align&&(t.align="center middle"),i=n.clone(),o=new p.RectAlign(a),o.align(n,t.align),r=n.topLeft().minus(i.topLeft()),this.options.useScroller||(r=this.pan().plus(r)),this.pan(r,t.animate))},alignShapes:function(e){var t,n,i,o,r,a,s;if(Q(e)&&(e="Left"),t=this.select(),0!==t.length){switch(e.toLowerCase()){case"left":case"top":n=Dt;break;case"right":case"bottom":n=At}for(o=0;t.length>o;o++)if(i=t[o],i instanceof d)switch(e.toLowerCase()){case"left":n=Math.min(n,i.options.x);break;case"top":n=Math.min(n,i.options.y);break;case"right":n=Math.max(n,i.options.x);break;case"bottom":n=Math.max(n,i.options.y)}for(r=[],a=[],o=0;t.length>o;o++)if(i=t[o],i instanceof d)switch(a.push(i),r.push(i.bounds()),e.toLowerCase()){case"left":case"right":i.position(new I(n,i.options.y));break;case"top":case"bottom":i.position(new I(i.options.x,n))}s=new p.TransformUnit(a,r),this.undoRedoService.add(s,!1)}},zoom:function(e,t){var n,i,o,r;return e&&(n=t?t.location:new p.Point(0,0),e=this._zoom=this._getValidZoom(e),Q(n)||(n=new p.Point(Math.round(n.x),Math.round(n.y)),i=n.times(e),o=this.modelToView(n),r=o.minus(i),this._storePan(new p.Point(Math.round(r.x),Math.round(r.y)))),t&&(t.zoom=e),this._panTransform(),this._autosizeCanvas(),this._updateAdorners()),this._zoom},pan:function(e,t){t=t||{animated:!1};var n=t.animated;return e instanceof I&&!e.equals(this._pan)&&(this._animatePan(e,!n),this._storePan(e),this.trigger(ft,{total:e,delta:t.delta}),this._autosizeCanvas(),this._updateAdorners()),this._pan},viewport:function(){var e=this.element;return new T(0,0,e.width(),e.height())},copy:function(){var e,t;if(this.options.copy.enabled)for(this._clipboard=[],this._copyOffset=1,e=0;this._selectedItems.length>e;e++)t=this._selectedItems[e],this._clipboard.push(t)},cut:function(){var e,t;if(this.options.copy.enabled){for(this._clipboard=[],this._copyOffset=0,e=0;this._selectedItems.length>e;e++)t=this._selectedItems[e],this._clipboard.push(t);this.remove(this._clipboard)}},paste:function(){var e,t,n,i,o,r,a,s;if(this._clipboard.length>0){for(s=new q,e=this._copyOffset*this.options.copy.offsetX,t=this._copyOffset*this.options.copy.offsetY,this.select(!1),a=0;this._clipboard.length>a;a++)n=this._clipboard[a],n instanceof c||(i=n.clone(),s.set(n.id,i.id),this._addItem(i),i.position(new I(n.options.x+e,n.options.y+t)),i.select(!0));for(a=0;this._clipboard.length>a;a++)n=this._clipboard[a],n instanceof d||(i=n.clone(),n.source()instanceof l&&(o=n.source(),s.containsKey(o.shape.id)?(r=this.getShapeById(s.get(o.shape.id)),i.source(r.getConnector(o.options.name))):i.source(new I(n.sourcePoint().x+e,n.sourcePoint().y+t))),n.target()instanceof l&&(o=n.target(),s.containsKey(o.shape.id)?(r=this.getShapeById(s.get(o.shape.id)),i.target(r.getConnector(o.options.name))):i.target(new I(n.targetPoint().x+e,n.targetPoint().y+t))),this._addItem(i),i.position(new I(n.options.x+e,n.options.y+t)),i.select(!0));this._copyOffset+=1}},boundingBox:function(e,t){var n,i,o,r=T.empty(),a=K(e)?this._getDiagramItems(e):{shapes:this.shapes};if(a.shapes.length>0)for(i=a.shapes[0],t===!0&&(r.x-=i._rotationOffset.x,r.y-=i._rotationOffset.y),r=i.bounds(zt),o=1;a.shapes.length>o;o++)i=a.shapes[o],n=i.bounds(zt),t===!0&&(n.x-=i._rotationOffset.x,n.y-=i._rotationOffset.y),r=r.union(n);return r},documentToView:function(t){var n=e(this.canvas.element).offset();return new I(t.x-n.left,t.y-n.top)},viewToDocument:function(t){var n=e(this.canvas.element).offset();return new I(t.x+n.left,t.y+n.top)},viewToModel:function(e){return this._transformWithMatrix(e,this._matrixInvert)},modelToView:function(e){return this._transformWithMatrix(e,this._matrix)},modelToLayer:function(e){return this._transformWithMatrix(e,this._layerMatrix)},layerToModel:function(e){return this._transformWithMatrix(e,this._layerMatrixInvert)},documentToModel:function(e){return this.viewToModel(this.documentToView(e))},modelToDocument:function(e){return this.viewToDocument(this.modelToView(e))},_transformWithMatrix:function(e,t){var n,i,o=e;return e instanceof I?t&&(o=t.apply(e)):(n=this._transformWithMatrix(e.topLeft(),t),i=this._transformWithMatrix(e.bottomRight(),t),o=T.fromPoints(n,i)),o},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},layout:function(e){var t,n,i,o,r;switch(this.isLayouting=!0,Q(e)&&(e=this.options.layout),t=Q(e)||Q(e.type)?"Tree":e.type,t.toLowerCase()){case"tree":n=new p.TreeLayout(this);break;case"layered":n=new p.LayeredLayout(this);break;case"forcedirected":case"force":case"spring":case"springembedder":n=new p.SpringLayout(this);break;default:throw"Layout algorithm '"+t+"' is not supported."}i=new p.LayoutState(this),o=n.layout(e),o&&(r=new p.LayoutUndoUnit(i,o,e?e.animate:null),this.undoRedoService.add(r)),this.isLayouting=!1},getShapeById:function(e){var t;return(t=N.first(this.shapes,function(t){return t.visual.domElement.id===e}))?t:t=N.first(this.connections,function(t){return t.visual.domElement.id===e})},editor:function(e,t){var n,i=this._editor;return(Q(e.options.editable)||e.options.editable.text)&&(i.options=v(this.options.editor,t),this._editItem=e,this._showEditor(),n=e.content(),i._originalContent=n,i.content(n),i.focus()),i},_initEditor:function(){this._editor=new p.TextBlockEditor,this._editor.bind("finishEdit",e.proxy(this._finishEditShape,this))},_showEditor:function(){var e=this._editor;e.visible(!0),this.element.context.appendChild(e.domElement),this._positionEditor()},_positionEditor:function(){var t=this._editor,n=t.options,i=e(t.domElement),o=this.modelToView(this._editItem.bounds()),r=function(e){return parseInt(i.css(e),10)},a=new I(r("borderLeftWidth")+r("paddingLeft"),r("borderTopWidth")+r("paddingTop")),s=new I(n.margin,o.height/2-n.height/2).minus(a);t.size(o.width-2*n.margin,n.height),t.position(o.topLeft().plus(s)),i.css({fontSize:n.fontSize})},_extendLayoutOptions:function(e){e.layout&&(e.layout=v(p.LayoutBase.fn.defaultOptions||{},e.layout))},_finishEditShape:function(){var e,t=this._editor,n=this._editItem;n&&(e=new p.ContentChangedUndoUnit(n,t._originalContent,t.content()),this.undoRedoService.add(e),t.visible(!1))},_selectionChanged:function(e,t){this.trigger(ht,{selected:e,deselected:t})},_getValidZoom:function(e){return Math.min(Math.max(e,.55),2)},_panTransform:function(e){var t=this,n=e||t._pan;this.scroller?(t.scroller.scrollTo(n.x,n.y),t._zoomMainLayer()):(t._pan=n,t._transformMainLayer())},_animatePan:function(e,t){var n,i=this;t?this._panTransform(e):i.scroller?(i.scroller.animatedScrollTo(e.x,e.y),i._zoomMainLayer()):(n=new U,n.addAdapter(new a({pan:e,diagram:this})),n.onStep=function(){i._finishPan()},n.play())},_finishPan:function(){this.trigger(ft,{total:this._pan,delta:Number.NaN})},_storePan:function(e){this._pan=e,this._storeViewMatrix()},_zoomMainLayer:function(){var e=this._zoom,t=new C(0,0,e,e);t.render(this.mainLayer.domElement),this._storeLayerMatrix(t),this._storeViewMatrix()},_transformMainLayer:function(){var e=this._pan,t=this._zoom,n=new C(e.x,e.y,t,t);n.render(this.mainLayer.domElement),this._storeLayerMatrix(n),this._storeViewMatrix()
},_storeLayerMatrix:function(e){this._layerMatrix=e.toMatrix(),this._layerMatrixInvert=e.invert().toMatrix()},_storeViewMatrix:function(){var e=this._pan,t=this._zoom,n=new C(e.x,e.y,t,t);this._matrix=n.toMatrix(),this._matrixInvert=n.invert().toMatrix()},_toIndex:function(e,t){var n=this._getDiagramItems(e);this.mainLayer.toIndex(n.visuals,t),this._fixOrdering(n,!1)},_fixOrdering:function(e,t){var n,i,o=t?this.shapes.length-1:0,r=t?this.connections.length-1:0;for(n=0;e.shapes.length>n;n++)i=e.shapes[n],N.remove(this.shapes,i),N.insert(this.shapes,i,o);for(n=0;e.cons.length>n;n++)i=e.cons[n],N.remove(this.connections,i),N.insert(this.connections,i,r)},_getDiagramItems:function(e){var t,n,i={},o=e;for(i.visuals=[],i.shapes=[],i.cons=[],e?$(e)||(o=[e]):o=this._selectedItems.slice(),t=0;o.length>t;t++)n=o[t],n instanceof d?(i.shapes.push(n),i.visuals.push(n.visual)):n instanceof c&&(i.cons.push(n),i.visuals.push(n.visual));return i},_removeItem:function(e,t){e.select(!1),e instanceof d?this._removeShape(e,t):e instanceof c&&this._removeConnection(e,t),t||this.mainLayer.remove(e.visual)},_removeShape:function(e,t){var n,i,o,r,a=[],s=[];for(this.toolService._removeHover(),t?this.undoRedoService.addCompositeItem(new D(e)):N.remove(this.shapes,e),n=0;e.connectors.length>n;n++)for(o=e.connectors[n],r=0;o.connections.length>r;r++)i=o.connections[r],i.sourceConnector==o?a.push(i):i.targetConnector==o&&s.push(i);for(n=0;a.length>n;n++)a[n].source(null,t);for(n=0;s.length>n;n++)s[n].target(null,t)},_removeConnection:function(e,t){e.sourceConnector&&N.remove(e.sourceConnector.connections,e),e.targetConnector&&N.remove(e.targetConnector.connections,e),t?this.undoRedoService.addCompositeItem(new A(e)):N.remove(this.connections,e)},_canRectSelect:function(){var e=this.options.selectable.type;return e===yt},_refreshSource:function(e){function t(e){var t,n;if(!Q(e))return(t=N.first(o._dataMap,function(t){return t.uid===e.uid}))?t.shape:(n=v({},o.options.shapeDefaults,{dataItem:e}),t=new d(n,e),o.addShape(t),o._dataMap.push({uid:e.uid,shape:t}),t)}function n(e,n){var i,r,a,s,l;for(i=0;n.length>i;i++)r=n[i],a=t(r),s=t(e),s&&!o.connected(s,a)&&(l=o.connect(s,a),l.type(et))}var i,o=this,r=e.node,a=e.action,s=e.items;if(!e.field){if(a&&"add"!==a){if("remove"===a);else if("itemchange"===a)if(r)s.length&&n(r,s);else for(i=0;s.length>i;i++)t(s[i])}else n(r,s);for(i=0;s.length>i;i++)s[i].load()}o.options.layout&&o.layout(o.options.layout)},_mouseDown:function(e){if(!this.pauseMouseHandlers){var t=this._calculatePosition(e);0===e.button&&this.toolService.start(t,this._meta(e))&&e.preventDefault()}},_addItem:function(e){e instanceof d?this.addShape(e):e instanceof c&&this.addConnection(e)},_mouseUp:function(e){if(!this.pauseMouseHandlers){var t=this._calculatePosition(e);0===e.button&&this.toolService.end(t,this._meta(e))&&e.preventDefault()}},_mouseMove:function(e){if(!this.pauseMouseHandlers){var t=this._calculatePosition(e);0===e.button&&this.toolService.move(t,this._meta(e))&&e.preventDefault()}},_doubleClick:function(e){var t=this._calculatePosition(e);0===e.button&&this.toolService.doubleClick(t,this._meta(e))&&e.preventDefault()},_keydown:function(e){this.toolService.keyDown(e.keyCode,this._meta(e))&&e.preventDefault()},_wheel:function(e){var t=this._calculatePosition(e),n=v(this._meta(e),{delta:e.data.delta});this.toolService.wheel(t,n)&&e.preventDefault()},_meta:function(e){return{ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey}},_calculatePosition:function(e){var n=e.pageX===t?e.originalEvent:e,i=new I(n.pageX,n.pageY),o=this.documentToModel(i);return o},_normalizePointZoom:function(e){return e.times(1/this.zoom())},_initialize:function(){this._zoom=1,this._pan=new I,this.shapes=[],this._selectedItems=[],this.connections=[],this._adorners=[],this._dataMap=[],this.undoRedoService=new F,this.id=p.randomId()},_attachEvents:function(){var t=this;t.scroller&&(t.bind(nt,e.proxy(this._autosizeCanvas,this)),t.bind(it,e.proxy(this._autosizeCanvas,this)),t.bind(mt,e.proxy(this._autosizeCanvas,this)))},_fetchFreshData:function(){this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},_dataSource:function(){var e=this,t=e.options,n=t.dataSource;n=$(n)?{data:n}:n,n.fields||(n.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]),e.dataSource&&e._refreshHandler&&e._unbindDataSource(),e._refreshHandler=m(e._refreshSource,e),e._errorHandler=m(e._error,e),e.dataSource=_.create(n).bind(it,e._refreshHandler).bind(rt,e._errorHandler)},_unbindDataSource:function(){var e=this;e.dataSource.unbind(it,e._refreshHandler).unbind(rt,e._errorHandler)},_error:function(){},_adorn:function(e,n){n!==t&&e&&(n?(this._adorners.push(e),this.adornerLayer.append(e.visual)):(N.remove(this._adorners,e),this.adornerLayer.remove(e.visual)))},_showConnectors:function(e,t){t?this._connectorsAdorner.show(e):this._connectorsAdorner.destroy()},_autosizeCanvas:function(e){if(this.scroller){var t=(e||{}).sender||this,n=this._editor,i=t.zoom(),o=t.element,r=new T(0,0,o.width(),o.height()),a=t.boundingBox(t.shapes);a.width=(a.width+a.x)*i,a.height=(a.height+a.y)*i,a=a.union(r),t.canvas.size(a),n&&n.visible()&&this._positionEditor()}},_updateAdorners:function(){var e,t,n=this._adorners;for(e=0;n.length>e;e++)t=n[e],t.refreshBounds&&t.refreshBounds(),t.refresh()},_refresh:function(){var e;for(e=0;this.connections.length>e;e++)this.connections[e].refresh()}}),h.ui.plugin(u),kendo.deepExtend(p,{Shape:d,Connection:c,Connector:l})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});